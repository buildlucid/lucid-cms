import{y as c,B as y,T as o,e as D,a as l,u as z,G as $,b as w,z as X,x as b,I as Y,a5 as P,a7 as Z,L as ee,E as te,f as H,d as ae,v as ne,W as oe}from"./index-CQ3-BSEL.js";import{u as se}from"./useSearchParamsLocation-Sjso8rcp.js";import{Q as ie}from"./Tr-Dh-rHsqH.js";import{t as le,D as re,a as ce,c as ue,b as de,f as j}from"./document-table-helpers-BJrpbsvl.js";import{S as ge}from"./Standard-DQ0Jv3GR.js";import"./MediaFolderCard-DV834B6M.js";import{r as me}from"./Tooltip-C4WAYcWb.js";import{u as fe}from"./useRowTarget-DdIL0a9L.js";import{P as ye}from"./Paginated-uZRH6cV0.js";import{D as he}from"./ContentLocaleSelect-Cb-MBOKh.js";import{C as L}from"./Confirmation-BG2UDkdk.js";import{a as be}from"./DateCol-D5X8S346.js";import"./ActionDropdown-DU8N8G-B.js";import"./PillCol-CVehCi4c.js";import"./Pill-BBVDx-5p.js";import"./ISASYZ5H-BKhR2em3.js";import"./ErrorMessage-BUQl5hDc.js";import"./DateText-zHyly9WS.js";import"./date-helpers-BWhv-7yI.js";const De=e=>{const r=c(()=>{var t;return y.getLocaleValue({value:(t=e.collection)==null?void 0:t.details.singularName})||o()("collection")}),s=D.documents.usePromoteSingle({onSuccess:()=>{var t;e.state.setOpen(!1),(t=e.callbacks)!=null&&t.onSuccess&&e.callbacks.onSuccess()},getCollectionName:r,getVersionType:()=>"draft"});return l(L,{theme:"primary",get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:s.action.isPending,isError:s.action.isError}},get copy(){var t;return{title:o()("promote_to_draft_modal_title"),description:o()("promote_to_draft_modal_description"),error:(t=s.errors())==null?void 0:t.message}},callbacks:{onConfirm:()=>{var h;const t=typeof e.id=="function"?e.id():e.id,d=typeof e.publishedVersionId=="function"?e.publishedVersionId():e.publishedVersionId;if(!t)return console.error("No id provided");if(!d)return console.error("No versionId provided");(h=e.collection)!=null&&h.key&&s.action.mutate({id:t,collectionKey:e.collection.key,versionId:d,body:{versionType:"draft"}})},onCancel:()=>{e.state.setOpen(!1),s.reset()}}})},ke=e=>{const r=c(()=>{var t;return y.getLocaleValue({value:(t=e.collection)==null?void 0:t.details.singularName})||o()("collection")}),s=D.documents.usePromoteSingle({onSuccess:()=>{var t;e.state.setOpen(!1),(t=e.callbacks)!=null&&t.onSuccess&&e.callbacks.onSuccess()},getCollectionName:()=>r(),getVersionType:()=>"published"});return l(L,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:s.action.isPending,isError:s.action.isError}},get copy(){var t;return{title:o()("publish_document_modal_title",{name:r()}),description:o()("publish_document_modal_description",{name:r().toLowerCase()}),error:(t=s.errors())==null?void 0:t.message}},callbacks:{onConfirm:()=>{var h;const t=typeof e.id=="function"?e.id():e.id,d=typeof e.draftVersionId=="function"?e.draftVersionId():e.draftVersionId;if(!t)return console.error("No id provided");if(!d)return console.error("No draft id provided");(h=e.collection)!=null&&h.key&&s.action.mutate({collectionKey:e.collection.key,id:t,versionId:d,body:{versionType:"published"}})},onCancel:()=>{e.state.setOpen(!1),s.reset()}}})},Se=e=>{const r=D.documents.useRestore({onSuccess:()=>{e.state.setOpen(!1)}});return l(L,{theme:"primary",get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:r.action.isPending,isError:r.action.isError}},get copy(){var s;return{title:o()("restore_document_modal_title"),description:o()("restore_document_modal_description"),error:(s=r.errors())==null?void 0:s.message}},callbacks:{onConfirm:()=>{var t,d;const s=e.id();if(!s)return console.error("No id provided");if(!((t=e.collection)!=null&&t.key))return console.error("No collection key provided");r.action.mutate({collectionKey:(d=e.collection)==null?void 0:d.key,body:{ids:[s]}})},onCancel:()=>{e.state.setOpen(!1),r.reset()}}})},_e=e=>{const r=c(()=>{var t;return y.getLocaleValue({value:(t=e.collection)==null?void 0:t.details.singularName})||o()("collection")}),s=D.documents.useDeleteSinglePermanently({onSuccess:()=>{var t;e.state.setOpen(!1),(t=e.callbacks)!=null&&t.onSuccess&&e.callbacks.onSuccess()},getCollectionName:r});return l(L,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:s.action.isPending,isError:s.action.isError}},get copy(){var t;return{title:o()("delete_document_permanently_modal_title"),description:o()("delete_document_permanently_modal_description"),error:(t=s.errors())==null?void 0:t.message}},callbacks:{onConfirm:()=>{const t=e.id();if(!t)return console.error("No id provided");s.action.mutate({id:t,collectionKey:e.collection.key})},onCancel:()=>{e.state.setOpen(!1),s.reset()}}})},Ie=e=>{const r=z(),s=$(),t=fe({triggers:{delete:!1,promote:!1,publish:!1,restore:!1,deletePermanently:!1}}),[d,h]=w(),[T,O]=w(),[v,u]=w(),V=()=>{var n;r(P("create",{collectionKey:k(),useDrafts:(n=e.state.collection)==null?void 0:n.config.useDrafts}))},k=c(()=>s.collectionKey),N=c(()=>X.get.contentLocale??""),E=c(()=>le(e.state.displayInListing())),K=c(()=>e.state.searchParams.getSettled()===!0&&e.state.collectionIsSuccess()===!0),p=c(()=>e.state.showingDeleted()?b.get.hasPermission(["update_content"]).some:b.get.hasPermission(["delete_content"]).some),a=c(()=>{var n;return y.getLocaleValue({value:(n=e.state.collection)==null?void 0:n.details.name})}),g=c(()=>{var n;return y.getLocaleValue({value:(n=e.state.collection)==null?void 0:n.details.singularName})||o()("collection")}),S=c(()=>e.state.showingDeleted()?1:0),C=c(()=>e.state.showingDeleted()?{title:o()("no_deleted_documents",{collectionMultiple:a()}),description:o()("no_deleted_documents_description")}:{title:o()("no_documents",{collectionMultiple:a()}),description:o()("no_documents_description",{collectionMultiple:a().toLowerCase(),collectionSingle:g().toLowerCase()}),button:o()("create_document",{collectionSingle:g()})}),F=c(()=>{if(!e.state.showingDeleted())return V}),f=D.documents.useGetMultiple({queryParams:{queryString:e.state.searchParams.getQueryString,location:{collectionKey:k,versionType:e.state.status},filters:{isDeleted:S}},enabled:()=>K()}),J=D.documents.useDeleteMultiple({getCollectionName:g}),U=D.documents.useRestore();return l(he,{get state(){var n;return{isError:f.isError,isSuccess:f.isSuccess,isEmpty:((n=f.data)==null?void 0:n.data.length)===0,searchParams:e.state.searchParams}},get slot(){return{footer:l(ye,{get state(){var n;return{searchParams:e.state.searchParams,meta:(n=f.data)==null?void 0:n.meta}},options:{padding:"24"}})}},get copy(){return{noEntries:C()}},get permissions(){return{create:b.get.hasPermission(["create_content"]).some}},get callback(){return{createEntry:F()}},get children(){return[l(be,{get key(){var n;return`documents.list.${(n=e.state.collection)==null?void 0:n.key}`},get rows(){var n;return((n=f.data)==null?void 0:n.data.length)||0},get searchParams(){return e.state.searchParams},get head(){return[...E(),{label:o()("status"),key:"status",icon:l(Z,{})},{label:o()("updated_at"),key:"updated_at",icon:l(ee,{})}]},get state(){return{isLoading:f.isFetching||e.state.isLoading,isSuccess:f.isSuccess}},get options(){return{isSelectable:p(),allowRestore:e.state.showingDeleted(),allowDelete:!e.state.showingDeleted()}},callbacks:{deleteRows:async n=>{var _,I;const m=[];for(const i in n)n[i]&&((_=f.data)!=null&&_.data[i].id)&&m.push((I=f.data)==null?void 0:I.data[i].id);await J.action.mutateAsync({collectionKey:k(),body:{ids:m}})},restoreRows:async n=>{var _,I;const m=[];for(const i in n)n[i]&&((_=f.data)!=null&&_.data[i].id)&&m.push((I=f.data)==null?void 0:I.data[i].id);await U.action.mutateAsync({collectionKey:k(),body:{ids:m}})}},children:({include:n,isSelectable:m,selected:_,setSelected:I})=>l(Y,{get each(){var i;return((i=f.data)==null?void 0:i.data)||[]},children:(i,R)=>l(re,{index:R,get document(){return i()},get fieldInclude(){return e.state.displayInListing()},get collection(){return e.state.collection},include:n,get contentLocale(){return N()},get selected(){return _[R]},options:{isSelectable:m},callbacks:{setSelected:I},get actions(){var x,M,q;return[{label:o()("edit"),type:"button",onClick:()=>{var Q,A,G,W,B;if(e.state.status()==="published"&&(Q=e.state.collection)!=null&&Q.config.useDrafts&&typeof((G=(A=i().version)==null?void 0:A.draft)==null?void 0:G.id)!="number"){O(i().versionId),h(i().id),t.setTargetId(i().id),t.setTrigger("promote",!0);return}r(P("edit",{collectionKey:(W=e.state.collection)==null?void 0:W.key,useDrafts:(B=e.state.collection)==null?void 0:B.config.useDrafts,documentId:i().id,statusOverride:e.state.status()}))},permission:b.get.hasPermission(["update_content"]).some,hide:e.state.showingDeleted()},{label:o()("publish"),type:"button",onClick:()=>{u(i().versionId),h(i().id),t.setTargetId(i().id),t.setTrigger("publish",!0)},permission:b.get.hasPermission(["publish_content"]).all,hide:((x=e.state.collection)==null?void 0:x.config.useDrafts)!==!0||e.state.status()!=="draft"||e.state.showingDeleted(),actionExclude:!0},{label:o()("restore"),type:"button",onClick:()=>{t.setTargetId(i().id),t.setTrigger("restore",!0)},permission:b.get.hasPermission(["update_media"]).all,hide:e.state.showingDeleted()===!1,theme:"primary"},{label:o()("delete"),type:"button",onClick:()=>{t.setTargetId(i().id),t.setTrigger("delete",!0)},permission:b.get.hasPermission(["delete_content"]).all,actionExclude:!0,theme:"error",hide:e.state.showingDeleted()},{label:o()("delete_permanently"),type:"button",onClick:()=>{t.setTargetId(i().id),t.setTrigger("deletePermanently",!0)},permission:b.get.hasPermission(["delete_content"]).all,hide:((q=(M=e.state).showingDeleted)==null?void 0:q.call(M))===!1,theme:"error"}]}})})}),l(ce,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().delete,setOpen:n=>{t.setTrigger("delete",n)}}},get collection(){return e.state.collection}}),l(De,{get id(){return t.getTargetId},publishedVersionId:T,get collection(){return e.state.collection},get state(){return{open:t.getTriggers().promote,setOpen:n=>{t.setTrigger("promote",n)}}},callbacks:{onSuccess:()=>{var n,m;r(P("edit",{collectionKey:(n=e.state.collection)==null?void 0:n.key,useDrafts:(m=e.state.collection)==null?void 0:m.config.useDrafts,documentId:d(),statusOverride:"draft"}))}}}),l(ke,{get id(){return t.getTargetId},draftVersionId:v,get collection(){return e.state.collection},get state(){return{open:t.getTriggers().publish,setOpen:n=>{t.setTrigger("publish",n)}}},callbacks:{onSuccess:()=>{var n,m;r(P("edit",{collectionKey:(n=e.state.collection)==null?void 0:n.key,useDrafts:(m=e.state.collection)==null?void 0:m.config.useDrafts,documentId:d(),statusOverride:"published"}))}}}),l(Se,{get id(){return t.getTargetId},get collection(){return e.state.collection},get state(){return{open:t.getTriggers().restore,setOpen:n=>{t.setTrigger("restore",n)}}}}),l(_e,{get id(){return t.getTargetId},get collection(){return e.state.collection},get state(){return{open:t.getTriggers().deletePermanently,setOpen:n=>{t.setTrigger("deletePermanently",n)}}}})]}})},Ge=()=>{const e=te(),r=$(),s=z(),t=se(void 0,{manualSettled:!0}),[d,h]=w("draft"),[T,O]=w(!1),v=c(()=>r.collectionKey),u=D.collections.useGetSingle({queryParams:{location:{collectionKey:v}},refetchOnWindowFocus:!1,enabled:()=>!!v()}),V=c(()=>{var a;return ue((a=u.data)==null?void 0:a.data)}),k=c(()=>{var a;return de((a=u.data)==null?void 0:a.data)}),N=c(()=>u.isSuccess),E=c(()=>{var a;return y.getLocaleValue({value:(a=u.data)==null?void 0:a.data.details.name})}),K=c(()=>{var a;return y.getLocaleValue({value:(a=u.data)==null?void 0:a.data.details.singularName})}),p=c(()=>{var a;return y.getLocaleValue({value:(a=u.data)==null?void 0:a.data.details.summary})});return H(()=>{u.isSuccess&&(h(u.data.data.config.useDrafts?"draft":"published"),u.data.data.mode==="single"&&s("/admin/collections"))}),H(()=>{if(u.isSuccess){const a={};for(const g of k())switch(g.type){default:{a[j({fieldKey:g.key})]={type:"text",value:""};break}}t.setFilterSchema(a)}}),l(oe,{get slots(){return{topBar:l(ne,{style:"layout",get alerts(){var a;return[{type:"warning",message:o()("locked_collection_message"),show:((a=u.data)==null?void 0:a.data.config.isLocked)===!0}]}}),header:l(ge,{get copy(){return{title:E(),description:p()}},get actions(){var a,g,S;return{contentLocale:((a=u.data)==null?void 0:a.data.config.useTranslations)??!1,createLink:{link:P("create",{collectionKey:v(),useDrafts:(g=u.data)==null?void 0:g.data.config.useDrafts}),permission:b.get.hasPermission(["create_content"]).some,show:((S=u.data)==null?void 0:S.data.config.isLocked)!==!0,label:o()("create_dynamic",{name:K()||""})}}},get slots(){return{bottom:l(ie,{searchParams:t,showingDeleted:T,setShowingDeleted:O,onRefresh:()=>{e.invalidateQueries({queryKey:["documents.getMultiple"]})},get filters(){return k().map(a=>{var S;const g=j({fieldKey:a.key});switch(a.type){case"checkbox":return{label:y.getLocaleValue({value:a.details.label,fallback:a.key}),key:g,type:"boolean"};case"select":return{label:y.getLocaleValue({value:a.details.label,fallback:a.key}),key:g,type:"select",options:(S=a.options)==null?void 0:S.map((C,F)=>({value:C.value,label:y.getLocaleValue({value:C.label,fallback:o()("option_label",{count:F})})}))};default:return{label:y.getLocaleValue({value:a.details.label,fallback:a.key}),key:g,type:"text"}}})},get custom(){return l(ae,{get when(){var a;return(a=u.data)==null?void 0:a.data.config.useDrafts},get children(){return l(me,{id:"status",get value(){return d()==="published"},onChange:a=>{h(a?"published":"draft")},name:"status",get copy(){return{true:o()("published"),false:o()("draft")}},options:{queryRow:!0}})}})},perPage:[]})}}})}},get children(){return l(Ie,{get state(){var a;return{collection:(a=u.data)==null?void 0:a.data,displayInListing:V,searchParams:t,isLoading:u.isFetching,collectionIsSuccess:N,status:d,showingDeleted:T}}})}})};export{Ge as default};
