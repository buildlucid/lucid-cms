import{y as p,a as n,b as E,z as V,e as _,t as w,i as f,T as i,r as le,B as x,f as F,d as W,I as ie,a7 as re,L as se,F as ae,u as q,G as ce,E as X,a5 as ue,X as de,Y as U,M as R,v as ge,h as me}from"./index-CQ3-BSEL.js";import{M as N,a as be,b as fe,B as pe,u as ye,H as ve,A as he,C as ke,F as Se,c as _e}from"./useDocumentUIState-BmTsPFAa.js";import{u as Y}from"./useSearchParamsState-BdNLU5Q4.js";import{t as M,C as xe,u as P,r as Ce,v as S,I as j,B as H,w as a,x as C,y as we}from"./Tooltip-C4WAYcWb.js";import{F as J,S as $e,P as Z}from"./Tr-Dh-rHsqH.js";import{G as Me}from"./Grid-OY6rmIwE.js";import{D as ee}from"./ContentLocaleSelect-Cb-MBOKh.js";import{P as De}from"./Paginated-uZRH6cV0.js";import{a as Le}from"./DateCol-D5X8S346.js";import{c as Pe,b as Ie,t as Ee,D as Fe,a as Be}from"./document-table-helpers-BJrpbsvl.js";import{C as Ne}from"./ActionDropdown-DU8N8G-B.js";import{d as T}from"./ISASYZ5H-BKhR2em3.js";import{g as L}from"./error-helpers-D9jUdhyT.js";import"./DateText-zHyly9WS.js";import"./date-helpers-BWhv-7yI.js";import"./Pill-BBVDx-5p.js";import"./useSearchParamsLocation-Sjso8rcp.js";import"./Confirmation-BG2UDkdk.js";import"./ErrorMessage-BUQl5hDc.js";import"./PillCol-CVehCi4c.js";var Ke=w('<div class="min-h-[70vh] flex flex-col"><div class="p-4 md:p-6 border-b border-border"><h2></h2><p class=mt-1></p><div class="w-full mt-4 flex justify-between"><div class="flex gap-2.5"></div><div></div></div></div><div class="flex-1 flex w-full flex-col">');const Ae=()=>{const e=p(()=>M.get.open);return n(N,{get state(){return{open:e(),setOpen:()=>M.set("open",!1)}},options:{noPadding:!0,size:"large"},get children(){return n(Te,{})}})},Te=()=>{const e=Y({filters:{title:{value:"",type:"text"},extension:{value:M.get.extensions||"",type:"text"},type:{value:M.get.type||"",type:"array"},mimeType:{value:"",type:"text"},key:{value:"",type:"text"}},sorts:{fileSize:void 0,title:void 0,width:void 0,height:void 0,mimeType:void 0,extension:void 0,createdAt:void 0,updatedAt:"desc"},pagination:{perPage:20}},{singleSort:!0}),[t,o]=E(0),l=p(()=>V.get.contentLocale),g=_.media.useGetMultiple({queryParams:{queryString:e.getQueryString,headers:{"lucid-content-locale":l},filters:{isDeleted:t}}});return(()=>{var r=Ke(),m=r.firstChild,y=m.firstChild,h=y.nextSibling,c=h.nextSibling,v=c.firstChild,k=v.nextSibling,u=m.nextSibling;return f(y,()=>i()("select_media_title")),f(h,()=>i()("select_media_description")),f(v,n(J,{get filters(){return[{label:i()("title"),key:"title",type:"text"},{label:i()("mime_type"),key:"mimeType",type:"text"},{label:i()("key"),key:"key",type:"text"},{label:i()("type"),key:"type",type:"multi-select",options:[{label:i()("image"),value:"image"},{label:i()("video"),value:"video"},{label:i()("audio"),value:"audio"},{label:i()("document"),value:"document"},{label:i()("archive"),value:"archive"},{label:i()("unknown"),value:"unknown"}]},{label:i()("file_extension"),key:"extension",type:"text"}]},searchParams:e}),null),f(v,n($e,{get sorts(){return[{label:i()("title"),key:"title"},{label:i()("file_size"),key:"fileSize"},{label:i()("mime_type"),key:"mimeType"},{label:i()("file_extension"),key:"extension"},{label:i()("width"),key:"width"},{label:i()("height"),key:"height"},{label:i()("created_at"),key:"createdAt"},{label:i()("updated_at"),key:"updatedAt"}]},searchParams:e}),null),f(v,n(xe,{id:"isDeleted",get value(){return t()===1},onChange:d=>{o(d?1:0)},name:"isDeleted",get copy(){return{label:i()("show_deleted")}},theme:"error"}),null),f(k,n(Z,{options:[10,20,40],searchParams:e})),f(u,n(ee,{get state(){var d;return{isError:g.isError,isSuccess:g.isSuccess,isEmpty:((d=g.data)==null?void 0:d.data.length)===0,searchParams:e}},options:{padding:"24"},get copy(){return{noEntries:{title:i()("no_media"),description:i()("no_media_description"),button:i()("upload_media")}}},get slot(){return{footer:n(De,{get state(){var d;return{searchParams:e,meta:(d=g.data)==null?void 0:d.meta}},options:{padding:"24"}})}},get children(){return n(Me,{get state(){var d;return{isLoading:g.isLoading,totalItems:((d=g.data)==null?void 0:d.data.length)||0,searchParams:e}},get slots(){return{loadingCard:n(fe,{})}},get children(){return n(le,{get each(){var d;return(d=g.data)==null?void 0:d.data},children:d=>n(be,{media:d,get contentLocale(){return l()},get current(){return d.id===M.get.selected},onClick:()=>{M.get.onSelectCallback(d),M.set("open",!1)}})})}})}})),r})()};var Ve=w('<div class="min-h-[70vh] flex flex-col"><div class="p-4 md:p-6 border-b border-border"><h2></h2><p class=mt-1></p><div class="w-full mt-4 flex justify-between"><div class="flex gap-2.5"></div><div></div></div></div><div class="flex-1 flex w-full flex-col">');const qe=()=>{const e=p(()=>P.get.open);return n(N,{get state(){return{open:e(),setOpen:()=>P.set("open",!1)}},options:{noPadding:!0,size:"large"},get children(){return n(Qe,{})}})},Qe=()=>{const e=Y({filters:{},sorts:{},pagination:{perPage:20}}),[t,o]=E("draft"),l=p(()=>P.get.collectionKey),g=p(()=>V.get.contentLocale??""),r=_.collections.useGetSingle({queryParams:{location:{collectionKey:l}},enabled:()=>!!l()}),m=_.documents.useGetMultiple({queryParams:{queryString:e.getQueryString,location:{collectionKey:l,versionType:t},filters:{isDeleted:0}},enabled:()=>e.getSettled()&&r.isSuccess}),y=p(()=>{var s;return Pe((s=r.data)==null?void 0:s.data)}),h=p(()=>{var s;return Ie((s=r.data)==null?void 0:s.data)}),c=p(()=>Ee(y())),v=p(()=>{var s;return x.getLocaleValue({value:(s=r.data)==null?void 0:s.data.details.name})}),k=p(()=>{var s;return x.getLocaleValue({value:(s=r.data)==null?void 0:s.data.details.singularName})||i()("collection")}),u=p(()=>m.isSuccess||r.isSuccess),d=p(()=>m.isError||r.isError);return F(()=>{if(r.isSuccess){o(r.data.data.config.useDrafts?"draft":"published");const s={};for(const I of h())switch(I.type){default:{s[I.key]={type:"text",value:""};break}}e.setFilterSchema(s)}}),(()=>{var s=Ve(),I=s.firstChild,Q=I.firstChild,O=Q.nextSibling,te=O.nextSibling,K=te.firstChild,ne=K.nextSibling,oe=I.nextSibling;return f(Q,()=>i()("select_document_title")),f(O,()=>i()("select_document_description")),f(K,n(J,{get filters(){return h().map(b=>{var $;switch(b.type){case"checkbox":return{label:x.getLocaleValue({value:b.details.label,fallback:b.key}),key:b.key,type:"boolean"};case"select":return{label:x.getLocaleValue({value:b.details.label,fallback:b.key}),key:b.key,type:"select",options:($=b.options)==null?void 0:$.map((B,A)=>({value:B.value,label:x.getLocaleValue({value:B.label,fallback:i()("option_label",{count:A})})}))};default:return{label:x.getLocaleValue({value:b.details.label,fallback:b.key}),key:b.key,type:"text"}}})},searchParams:e}),null),f(K,n(W,{get when(){var b;return(b=r.data)==null?void 0:b.data.config.useDrafts},get children(){return n(Ce,{id:"status",get value(){return t()==="published"},onChange:b=>{o(b?"published":"draft")},name:"status",get copy(){return{true:i()("published"),false:i()("draft")}},options:{queryRow:!0}})}}),null),f(ne,n(Z,{options:[10,20,40],searchParams:e})),f(oe,n(ee,{get state(){var b;return{isError:d(),isSuccess:u(),searchParams:e,isEmpty:((b=m.data)==null?void 0:b.data.length)===0,isLoading:r.isLoading}},options:{},get copy(){return{noEntries:{title:i()("no_documents",{collectionMultiple:v()}),description:i()("no_documents_description_doc_select",{collectionMultiple:v().toLowerCase(),collectionSingle:k().toLowerCase()}),button:i()("create_document",{collectionSingle:k()})}}},get children(){return n(Le,{get key(){var b,$;return`documents.list.${($=(b=r.data)==null?void 0:b.data)==null?void 0:$.key}`},get rows(){var b;return((b=m.data)==null?void 0:b.data.length)||0},searchParams:e,get head(){return[...c(),{label:i()("status"),key:"status",icon:n(re,{})},{label:i()("updated_at"),key:"updated_at",icon:n(se,{})}]},get state(){return{isLoading:m.isLoading,isSuccess:m.isSuccess}},children:({include:b,isSelectable:$,selected:B,setSelected:A})=>n(ie,{get each(){var D;return((D=m.data)==null?void 0:D.data)||[]},children:(D,z)=>n(Fe,{index:z,get document(){return D()},get fieldInclude(){return y()},get collection(){var G;return(G=r.data)==null?void 0:G.data},include:b,get contentLocale(){return g()},get selected(){return B[z]},options:{isSelectable:$},callbacks:{setSelected:A,onClick:()=>{P.get.onSelectCallback(D()),P.set("open",!1)}},get current(){return D().id===P.get.selected}})})})}})),s})()};var Oe=w('<div class=p-6><div class="mb-6 pb-6 border-b border-border"><h2></h2></div><div class="mb-6 pb-6 border-b border-border"></div><div class="w-full flex gap-4 mt-6">');const ze=()=>{const[e,t]=E(""),[o,l]=E(""),[g,r]=E(!1),m=p(()=>S.get.open),y=p(()=>S.get.selectedLink),h=()=>{S.get.onSelectCallback({url:o(),target:g()?"_blank":"_self",label:e()}),S.set("open",!1),S.set("selectedLink",null)};return F(()=>{var c,v,k;t(((c=y())==null?void 0:c.label)||""),r(((v=y())==null?void 0:v.target)==="_blank"),l(((k=y())==null?void 0:k.url)||"")}),n(N,{get state(){return{open:m(),setOpen:()=>{S.set("open",!1),S.set("selectedLink",null)}}},options:{noPadding:!0},get children(){var c=Oe(),v=c.firstChild,k=v.firstChild,u=v.nextSibling,d=u.nextSibling;return f(k,()=>i()("set_link")),f(u,n(j,{id:"label",get value(){return e()},onChange:s=>t(s),name:"label",type:"text",get copy(){return{label:i()("label")}},required:!1,theme:"basic"}),null),f(u,n(j,{id:"url",get value(){return o()},onChange:s=>l(s),name:"url",type:"text",get copy(){return{label:i()("url")}},required:!1,theme:"basic"}),null),f(u,n(Ne,{id:"open_in_new_tab",get value(){return g()},onChange:s=>r(s),name:"open_in_new_tab",get copy(){return{label:i()("open_in_new_tab")}},required:!1,theme:"basic"}),null),f(d,n(H,{type:"button",theme:"primary",size:"medium",onClick:h,get children(){return i()("update")}}),null),f(d,n(H,{type:"button",theme:"border-outline",size:"medium",onClick:()=>{S.set("open",!1),S.set("selectedLink",null)},get children(){return i()("cancel")}}),null),c}})};var Ge=w('<div class="flex items-baseline justify-between p-4 md:p-6 border-b border-border"><div class="flex flex-col">'),Ue=w('<div class="p-4 md:p-6">');const Re=e=>{const t=p(()=>a.get.imagePreview.open),o=p(()=>a.get.imagePreview.data);return n(N,{get state(){return{open:t(),setOpen:l=>{a.set("imagePreview",{open:l,data:a.get.imagePreview.data})}}},options:{noPadding:!0},get children(){return[(()=>{var l=Ge(),g=l.firstChild;return f(g,n(T.Title,{get children(){var r;return(r=o())==null?void 0:r.title}}),null),f(g,n(W,{get when(){var r;return(r=o())==null?void 0:r.description},get children(){return n(T.Description,{class:"mt-1 text-sm",get children(){var r;return(r=o())==null?void 0:r.description}})}}),null),f(l,n(T.CloseButton,{class:"h-8 w-8 min-w-[32px] rounded-full flex justify-center items-center text-body hover:text-title duration-200 transition-colors",get children(){return n(ae,{})}}),null),l})(),(()=>{var l=Ue();return f(l,n(pe,{get data(){return{brick:o()}},options:{rounded:!0}})),l})()]}})},je=e=>{const t=q();return[n(Ae,{}),n(qe,{}),n(ze,{}),n(Re,{}),n(Be,{get id(){var o,l;return(l=(o=e.hooks.state.documentQuery)==null?void 0:o.data)==null?void 0:l.data.id},get state(){return{open:e.hooks.uiState.getDeleteOpen(),setOpen:e.hooks.uiState.setDeleteOpen}},get collection(){var o,l;return(l=(o=e.hooks.state.collectionQuery)==null?void 0:o.data)==null?void 0:l.data},callbacks:{onSuccess:()=>{var o;t(`/admin/collections/${(o=e.hooks.state.collectionQuery.data)==null?void 0:o.data.key}`)}}})]};function He(e){const t=ce(),o=q(),l=X(),g=p(()=>t.collectionKey),r=p(()=>Number.parseInt(t.documentId)||void 0),m=p(()=>V.get.contentLocale),y=p(()=>m()!==void 0&&r()!==void 0),h=_.collections.useGetSingle({queryParams:{location:{collectionKey:g}},enabled:()=>!!g(),refetchOnWindowFocus:!1}),c=_.documents.useGetSingle({queryParams:{location:{collectionKey:g,id:r,version:e.version},include:{bricks:!0}},enabled:()=>y(),refetchOnWindowFocus:!1}),v=p(()=>{var s;return(s=h.data)==null?void 0:s.data}),k=p(()=>{var s;return x.getLocaleValue({value:(s=v())==null?void 0:s.details.name})}),u=p(()=>{var s;return x.getLocaleValue({value:(s=v())==null?void 0:s.details.singularName})||i()("collection")}),d=p(()=>{var s;return(s=c.data)==null?void 0:s.data});return{collectionQuery:h,documentQuery:c,collectionKey:g,documentId:r,collectionName:k,collectionSingularName:u,contentLocale:m,navigate:o,queryClient:l,collection:v,document:d}}const We=()=>({captureFocus:()=>{const o=document.activeElement;if(!o)return{selector:null};let l=null;return o.id&&(l=`#${o.id}`),{selector:l}},restoreFocus:o=>{typeof(o==null?void 0:o.selector)=="string"&&setTimeout(()=>{if(typeof(o==null?void 0:o.selector)!="string")return;const l=document.querySelector(o.selector);l&&l.focus()},100)}});function Xe(e){const t=q(),o=X(),{captureFocus:l,restoreFocus:g}=We(),r=_.documents.useCreateSingle({onSuccess:u=>{var d;a.set("fieldsErrors",[]),a.set("brickErrors",[]),t(ue("edit",{collectionKey:e.collectionKey(),useDrafts:(d=e.collection())==null?void 0:d.config.useDrafts,documentId:u.data.id,statusOverride:e.version})),o.invalidateQueries({queryKey:["collections.getAll"]})},onError:u=>{a.set("fieldsErrors",L("fields",u)||[]),a.set("brickErrors",L("bricks",u)||[])},getCollectionName:e.collectionSingularName}),m=_.documents.useCreateSingleVersion({onSuccess:()=>{a.set("fieldsErrors",[]),a.set("brickErrors",[]),a.set("documentMutated",!1)},onError:u=>{a.set("fieldsErrors",L("fields",u)||[]),a.set("brickErrors",L("bricks",u)||[]),a.set("documentMutated",!1)},getCollectionName:e.collectionSingularName}),y=_.documents.useUpdateSingleVersion({onMutate:()=>{const u=l();a.set("focusState",u)},onSuccess:()=>{a.set("fieldsErrors",[]),a.set("brickErrors",[]),a.set("documentMutated",!1),g(a.get.focusState),a.set("focusState",null)},onError:u=>{a.set("fieldsErrors",L("fields",u)||[]),a.set("documentMutated",!1),g(a.get.focusState),a.set("focusState",null)},getCollectionName:e.collectionSingularName}),h=_.documents.usePromoteSingle({onSuccess:()=>{a.set("fieldsErrors",[]),a.set("documentMutated",!1)},onError:u=>{a.set("fieldsErrors",L("fields",u)||[]),a.set("documentMutated",!1)},getCollectionName:e.collectionSingularName,getVersionType:()=>"published"});return{createDocumentMutation:r,createSingleVersionMutation:m,updateSingleVersionMutation:y,promoteToPublishedMutation:h,upsertDocumentAction:async()=>{e.mode==="create"?r.action.mutate({collectionKey:e.collectionKey(),body:{publish:e.version==="published",bricks:C.getUpsertBricks(),fields:C.getCollectionPseudoBrickFields()}}):m.action.mutate({collectionKey:e.collectionKey(),documentId:e.documentId(),body:{publish:e.version==="published",bricks:C.getUpsertBricks(),fields:C.getCollectionPseudoBrickFields()}})},publishDocumentAction:async u=>{var d,s;if(!((s=(d=u==null?void 0:u.version)==null?void 0:d.draft)!=null&&s.id)){console.error("No draft version ID found.");return}h.action.mutate({collectionKey:e.collectionKey(),id:e.documentId(),versionId:u.version.draft.id,body:{versionType:"published"}})},autoSaveDocument:async u=>{y.action.mutate({collectionKey:e.collectionKey(),documentId:e.documentId(),versionId:u,body:{bricks:C.getUpsertBricks(),fields:C.getCollectionPseudoBrickFields()}})}}}function Ye(e){const t=we(()=>{var r,m,y;const o=(r=e.collection())==null?void 0:r.key,l=(m=e.document())==null?void 0:m.id,g=(y=e.document())==null?void 0:y.versionId;!o||!l||!g||e.updateSingleVersionMutation.action.mutate({collectionKey:o,documentId:l,versionId:g,body:{bricks:C.getUpsertBricks(),fields:C.getCollectionPseudoBrickFields()}})},500);return F(()=>{a.get.documentMutated&&a.get.autoSaveCounter!==0&&e.hasAutoSavePermission()&&t()}),de(()=>{t.clear()}),{debouncedAutoSave:t}}var Je=w('<span class="absolute top-0 left-[220px] right-4 h-32 bg-background-hover z-5">'),Ze=w('<div class="fixed top-4 left-[220px] bottom-4 right-4 flex flex-col z-10"><span class="h-32 w-full skeleton block mb-4"></span><span class="h-full w-full skeleton block">'),et=w('<div class="mt-2 bg-background-base rounded-t-xl border border-border flex-grow overflow-hidden"><div class="w-full flex grow"><div class="w-full flex flex-col">');const St=e=>{const t=He(e),o=Xe({collection:t.collection,collectionKey:t.collectionKey,documentId:t.documentId,collectionSingularName:t.collectionSingularName,version:e.version,mode:e.mode,document:t.document}),l=ye({collectionQuery:t.collectionQuery,collection:t.collection,document:t.document,documentQuery:t.documentQuery,mode:e.mode,version:e.version,createDocumentMutation:o.createDocumentMutation,createSingleVersionMutation:o.createSingleVersionMutation,updateSingleVersionMutation:o.updateSingleVersionMutation}),g=Ye({updateSingleVersionMutation:o.updateSingleVersionMutation,document:t.document,collection:t.collection,hasAutoSavePermission:l.hasAutoSavePermission}),r=()=>{var m;a.get.reset(),a.set("collectionTranslations",((m=t.collection())==null?void 0:m.config.useTranslations)||!1),a.get.setBricks(t.document(),t.collection()),a.set("locked",l.isBuilderLocked())};return F(U(()=>t.document(),()=>{r()})),F(U(()=>t.collectionQuery.isFetchedAfterMount,()=>{r()})),n(me,{get children(){return[n(R,{get when(){return l.isLoading()},get children(){return[Je(),Ze()]}}),n(R,{get when(){return l.isSuccess()},get children(){return[n(ve,{get mode(){return e.mode},get version(){return e.version},get state(){return{collection:t.collection,collectionKey:t.collectionKey,collectionName:t.collectionName,collectionSingularName:t.collectionSingularName,documentID:t.documentId,canNavigateToPublished:l.canNavigateToPublished,showRevisionNavigation:l.showRevisionNavigation}}}),n(he,{get mode(){return e.mode},get version(){return e.version},get state(){return{collection:t.collection,document:t.document,ui:l,autoSave:g}},get actions(){return{upsertDocumentAction:o.upsertDocumentAction,publishDocumentAction:o.publishDocumentAction}}}),(()=>{var m=et(),y=m.firstChild,h=y.firstChild;return f(m,n(ge,{style:"layout",get alerts(){return[{type:"info",message:i()("locked_document_message"),show:l.isBuilderLocked()},{type:"info",message:i()("collection_needs_migrating_message"),show:l.collectionNeedsMigrating()}]}}),y),f(h,n(ke,{get fields(){var c;return((c=t.collection())==null?void 0:c.fields)||[]},get collectionMigrationStatus(){var c;return(c=t.collection())==null?void 0:c.migrationStatus},get collectionKey(){return t.collectionKey()},get documentId(){return t.documentId()}}),null),f(h,n(Se,{get brickConfig(){var c;return((c=t.collection())==null?void 0:c.fixedBricks)||[]},get collectionMigrationStatus(){var c;return(c=t.collection())==null?void 0:c.migrationStatus},get collectionKey(){return t.collectionKey()},get documentId(){return t.documentId()}}),null),f(h,n(_e,{get brickConfig(){var c;return((c=t.collection())==null?void 0:c.builderBricks)||[]},get collectionMigrationStatus(){var c;return(c=t.collection())==null?void 0:c.migrationStatus},get collectionKey(){return t.collectionKey()},get documentId(){return t.documentId()}}),null),m})(),n(je,{hooks:{mutations:o,state:t,uiState:l}})]}})]}})};export{St as default};
