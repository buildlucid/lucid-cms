import{a,e as f,y as m,T as r,t as W,i as O,I as F,H as J,J as z,K as I,L as M,d as D,b as w,f as X,B as Y,x as S,N as Z,O as p,q as ee,E as te,W as re}from"./index-CQ3-BSEL.js";import{u as ae}from"./useSearchParamsLocation-Sjso8rcp.js";import{T as q,F as se,S as ne,P as ie,Q as le}from"./Tr-Dh-rHsqH.js";import{g as T}from"./error-helpers-D9jUdhyT.js";import{P as L}from"./Panel-BJ5ATSyq.js";import{C as G}from"./ActionDropdown-DU8N8G-B.js";import{b as Q,I as k}from"./Tooltip-C4WAYcWb.js";import{I as U}from"./InputGrid-CUmOd9Qi.js";import{S as ue}from"./Standard-DQ0Jv3GR.js";import"./MediaFolderCard-DV834B6M.js";import{u as de}from"./useRowTarget-DdIL0a9L.js";import{P as $}from"./Paginated-uZRH6cV0.js";import{D as j}from"./ContentLocaleSelect-Cb-MBOKh.js";import{d as N}from"./date-helpers-BWhv-7yI.js";import{u as oe}from"./useSearchParamsState-BdNLU5Q4.js";import{S as E}from"./SectionHeading-CnvfN_LE.js";import{D as R}from"./DetailsList-BHEhgC4b.js";import{T as v,D as H,a as B}from"./DateCol-D5X8S346.js";import{C as A}from"./Confirmation-BG2UDkdk.js";import{P as ge}from"./PillCol-CVehCi4c.js";import"./ISASYZ5H-BKhR2em3.js";import"./ErrorMessage-BUQl5hDc.js";import"./Pill-BBVDx-5p.js";import"./DateText-zHyly9WS.js";const ce=e=>a(q,{get index(){return e.index},get selected(){return e.selected},actions:[],get options(){return e.options},get callbacks(){return e.callbacks},get theme(){return e.theme},get children(){return[a(v,{get text(){return e.login.authMethod},get options(){var t;return{include:e==null?void 0:e.include[0],padding:(t=e.options)==null?void 0:t.padding}}}),a(v,{get text(){return e.login.ipAddress||"-"},get options(){var t;return{include:e==null?void 0:e.include[1],padding:(t=e.options)==null?void 0:t.padding}}}),a(v,{get text(){return e.login.userAgent||"-"},get options(){var t;return{include:e==null?void 0:e.include[2],maxLines:2,padding:(t=e.options)==null?void 0:t.padding}}}),a(H,{get date(){return e.login.createdAt},get options(){var t;return{include:e==null?void 0:e.include[3],padding:(t=e.options)==null?void 0:t.padding}}})]}});var me=W('<div class="mb-4 flex gap-2.5 flex-wrap items-center justify-between"><div class="flex gap-2.5">');const he=e=>{const t=f.users.useGetSingle({queryParams:{location:{userId:e.id}},enabled:()=>e.state.open&&e.id!==void 0}),s=m(()=>({title:r()("view_user_panel_title"),description:r()("view_user_panel_description")})),d=m(()=>({isLoading:t.isLoading,isError:t.isError}));return a(L,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get fetchState(){return d()},options:{padding:"24",hideFooter:!0},get copy(){return s()},children:()=>a(ye,{get id(){return e.id},get state(){var c;return{open:e.state.open,setOpen:e.state.setOpen,user:(c=t.data)==null?void 0:c.data}}})})},ye=e=>{const t=oe({filters:{authMethod:{value:"",type:"text"},ipAddress:{value:"",type:"text"}},sorts:{createdAt:"desc"},pagination:{perPage:5}},{singleSort:!0}),s=m(()=>e.state.open&&e.id!==void 0&&t.getSettled()),d=f.userLogins.useGetMultiple({queryParams:{queryString:t.getQueryString,location:{userId:e.id}},enabled:s}),c=m(()=>{var n,u;return((u=(n=e.state.user)==null?void 0:n.roles)==null?void 0:u.map(l=>l.name).join(", "))||"-"});return[a(E,{get title(){return r()("details")}}),a(R,{type:"text",get items(){var n,u,l,b,y;return[{label:r()("username"),value:(n=e.state.user)==null?void 0:n.username},{label:r()("email"),value:(u=e.state.user)==null?void 0:u.email},{label:r()("first_name"),value:((l=e.state.user)==null?void 0:l.firstName)||"-"},{label:r()("last_name"),value:((b=e.state.user)==null?void 0:b.lastName)||"-"},{label:r()("user_type"),value:(y=e.state.user)!=null&&y.superAdmin?r()("super_admin"):r()("standard")},{label:r()("roles"),value:c()}]}}),a(E,{get title(){return r()("meta")}}),a(R,{type:"text",get items(){var n,u;return[{label:r()("created_at"),value:N.formatDate((n=e.state.user)==null?void 0:n.createdAt)},{label:r()("updated_at"),value:N.formatDate((u=e.state.user)==null?void 0:u.updatedAt)}]}}),a(D,{get when(){return e.id!==void 0},get children(){return[a(E,{get title(){return r()("user_logins")},get description(){return r()("user_logins_description")}}),(()=>{var n=me(),u=n.firstChild;return O(u,a(se,{get filters(){return[{label:r()("auth_method"),key:"authMethod",type:"text"},{label:r()("ip_address"),key:"ipAddress",type:"text"}]},searchParams:t}),null),O(u,a(ne,{get sorts(){return[{label:r()("created_at"),key:"createdAt"}]},searchParams:t}),null),O(n,a(ie,{options:[5,10,20],searchParams:t}),null),n})(),a(j,{class:"bg-card-base border border-border rounded-md",get state(){var n;return{isError:d.isError,isSuccess:d.isSuccess,isEmpty:((n=d.data)==null?void 0:n.data.length)===0,searchParams:t}},get slot(){return{footer:a($,{get state(){var n;return{searchParams:t,meta:(n=d.data)==null?void 0:n.meta}},options:{embedded:!0}})}},get copy(){return{noEntries:{title:r()("no_user_logins"),description:r()("no_user_logins_description")}}},options:{inline:!0},get children(){return a(B,{key:"user.logins",get rows(){var n;return((n=d.data)==null?void 0:n.data.length)||0},searchParams:t,get head(){return[{label:r()("auth_method"),key:"authMethod",icon:a(J,{})},{label:r()("ip_address"),key:"ipAddress",icon:a(z,{})},{label:r()("user_agent"),key:"userAgent",icon:a(I,{})},{label:r()("created_at"),key:"createdAt",icon:a(M,{}),sortable:!0}]},get state(){return{isLoading:d.isFetching,isSuccess:d.isSuccess}},options:{isSelectable:!1,padding:"16",totalLoadingRows:5},theme:"secondary",children:({include:n,isSelectable:u,selected:l,setSelected:b})=>a(F,{get each(){var y;return((y=d.data)==null?void 0:y.data)||[]},children:(y,i)=>a(ce,{index:i,get login(){return y()},include:n,get selected(){return l[i]},options:{isSelectable:u,padding:"16"},callbacks:{setSelected:b},theme:"secondary"})})})}})]}})]},_e=e=>{const[t,s]=w([]),[d,c]=w(!1),n=f.roles.useGetMultiple({queryParams:{include:{permissions:!1},perPage:-1},enabled:()=>!e.id()}),u=f.users.useGetSingle({queryParams:{location:{userId:e.id}},enabled:()=>!!e.id()}),l=f.users.useUpdateSingle({onSuccess:()=>{e.state.setOpen(!1)}});X(()=>{var g,h,_;u.isSuccess&&(s(((h=(g=u.data)==null?void 0:g.data.roles)==null?void 0:h.map(o=>({value:o.id,label:o.name})))||[]),c(((_=u.data)==null?void 0:_.data.superAdmin)||!1))});const b=m(()=>u.isLoading||n.isLoading),y=m(()=>u.isError||n.isError),i=m(()=>{var g,h,_;return Y.updateData({roleIds:(h=(g=u.data)==null?void 0:g.data.roles)==null?void 0:h.map(o=>o.id),superAdmin:(_=u.data)==null?void 0:_.data.superAdmin},{roleIds:t().map(o=>o.value),superAdmin:d()})});return a(L,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get fetchState(){return{isLoading:b(),isError:y()}},get mutateState(){return{isLoading:l.action.isPending,isDisabled:!i().changed,errors:l.errors()}},callbacks:{onSubmit:()=>{l.action.mutate({id:e.id(),body:i().data})},reset:()=>{l.reset()}},get copy(){return{title:r()("update_user_panel_title"),description:r()("update_user_panel_description"),submit:r()("update")}},options:{padding:"24"},children:()=>[a(Q,{id:"roles",get values(){return t()},onChange:s,name:"roles",get copy(){return{label:r()("roles")}},get options(){var g;return((g=n.data)==null?void 0:g.data.map(h=>({value:h.id,label:h.name})))||[]},get errors(){return T("roleIds",l.errors)},theme:"full"}),a(D,{get when(){var g;return(g=S.get.user)==null?void 0:g.superAdmin},get children(){return a(G,{id:"superAdmin",get value(){return d()},onChange:g=>c(g),name:"superAdmin",get copy(){return{label:r()("is_super_admin")}},get errors(){return T("superAdmin",l.errors)},theme:"full"})}})]})},fe=e=>{const t=f.users.useDeleteSingle({onSuccess:()=>{e.state.setOpen(!1)}});return a(A,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var s;return{title:r()("delete_user_modal_title"),description:r()("delete_user_modal_description"),error:(s=t.errors())==null?void 0:s.message}},callbacks:{onConfirm:()=>{const s=e.id();if(!s)return console.error("No id provided");t.action.mutate({id:s})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})},be=e=>{const t=f.users.useUpdateSingle({onSuccess:()=>{e.state.setOpen(!1)}});return a(A,{theme:"primary",get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var s;return{title:r()("user_password_reset_modal_title"),description:r()("user_password_reset_modal_description"),error:(s=t.errors())==null?void 0:s.message}},callbacks:{onConfirm:()=>{const s=e.id();if(!s)return console.error("No id provided");t.action.mutate({id:s,body:{triggerPasswordReset:!0}})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})},Se=e=>{const t=m(()=>{var d;return e.user.id===((d=S.get.user)==null?void 0:d.id)}),s=m(()=>t()?`${e.user.username} (you)`:e.user.username);return a(q,{get index(){return e.index},get selected(){return e.selected},get actions(){var d,c,n,u,l;return[{label:r()("view"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.user.id),e.rowTarget.setTrigger("view",!0)},permission:!0},{label:r()("edit"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.user.id),e.rowTarget.setTrigger("update",!0)},permission:S.get.hasPermission(["update_user"]).all&&!t(),hide:(d=e.showingDeleted)==null?void 0:d.call(e)},{label:r()("restore"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.user.id),e.rowTarget.setTrigger("restore",!0)},permission:S.get.hasPermission(["update_user"]).all,hide:((c=e.showingDeleted)==null?void 0:c.call(e))===!1,theme:"primary"},{label:r()("delete"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.user.id),e.rowTarget.setTrigger("delete",!0)},permission:S.get.hasPermission(["delete_user"]).all&&!t(),actionExclude:!0,hide:(n=e.showingDeleted)==null?void 0:n.call(e)},{label:r()("delete_permanently"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.user.id),e.rowTarget.setTrigger("deletePermanently",!0)},permission:S.get.hasPermission(["delete_user"]).all,hide:((u=e.showingDeleted)==null?void 0:u.call(e))===!1,theme:"error"},{label:r()("reset_password"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.user.id),e.rowTarget.setTrigger("passwordReset",!0)},permission:S.get.hasPermission(["update_user"]).all&&!t(),actionExclude:!0,hide:(l=e.showingDeleted)==null?void 0:l.call(e)}]},get options(){return e.options},get callbacks(){return e.callbacks},get children(){return[a(v,{get text(){return s()},get options(){return{include:e==null?void 0:e.include[0]}}}),a(v,{get text(){return e.user.firstName},get options(){return{include:e==null?void 0:e.include[1]}}}),a(v,{get text(){return e.user.lastName},get options(){return{include:e==null?void 0:e.include[2]}}}),a(ge,{get text(){return m(()=>!!e.user.superAdmin)()?r()("super_admin"):r()("standard")},get options(){return{include:e==null?void 0:e.include[3]}}}),a(v,{get text(){return e.user.email},get options(){return{include:e==null?void 0:e.include[4]}}}),a(H,{get date(){return e.user.createdAt},get options(){return{include:e==null?void 0:e.include[5]}}})]}})},Pe=e=>{const t=f.users.useRestore({onSuccess:()=>{e.state.setOpen(!1)}});return a(A,{theme:"primary",get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var s;return{title:r()("restore_users_modal_title"),description:r()("restore_users_modal_description"),error:(s=t.errors())==null?void 0:s.message}},callbacks:{onConfirm:()=>{const s=e.id();if(!s){console.log("No user ID supplied!"),e.state.setOpen(!1),t.reset();return}t.action.mutate({body:{ids:[s]}})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})},we=e=>{const t=f.users.useDeleteSinglePermanently({onSuccess:()=>{e.state.setOpen(!1)}});return a(A,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var s;return{title:r()("delete_user_permanently_modal_title"),description:r()("delete_user_permanently_modal_description"),error:(s=t.errors())==null?void 0:s.message}},callbacks:{onConfirm:()=>{const s=e.id();if(!s)return console.error("No id provided");t.action.mutate({id:s})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})},Te=e=>{var y;const t=de({triggers:{view:!1,update:!1,delete:!1,passwordReset:!1,restore:!1,deletePermanently:!1}}),s=()=>{e.state.setOpenCreateUserPanel(!0)},d=m(()=>e.state.showingDeleted()?1:0),c=m(()=>e.state.showingDeleted()?{title:r()("no_deleted_users"),description:r()("no_deleted_users_description")}:{title:r()("no_users"),description:r()("no_users_description"),button:r()("create_user")}),n=m(()=>{if(!e.state.showingDeleted())return s}),u=m(()=>e.state.showingDeleted()?S.get.hasPermission(["update_user"]).some:!1),l=f.users.useGetMultiple({queryParams:{queryString:(y=e.state)==null?void 0:y.searchParams.getQueryString,filters:{isDeleted:d}},enabled:()=>{var i;return(i=e.state)==null?void 0:i.searchParams.getSettled()}}),b=f.users.useRestore();return a(j,{get state(){var i;return{isError:l.isError,isSuccess:l.isSuccess,isEmpty:((i=l.data)==null?void 0:i.data.length)===0,searchParams:e.state.searchParams}},get slot(){return{footer:a($,{get state(){var i;return{searchParams:e.state.searchParams,meta:(i=l.data)==null?void 0:i.meta}},options:{padding:"24"}})}},get copy(){return{noEntries:c()}},get callback(){return{createEntry:n()}},get children(){return[a(B,{key:"users.list",get rows(){var i;return((i=l.data)==null?void 0:i.data.length)||0},get searchParams(){return e.state.searchParams},get head(){return[{label:r()("username"),key:"username",icon:a(Z,{})},{label:r()("first_name"),key:"firstName",icon:a(I,{})},{label:r()("last_name"),key:"lastName",icon:a(I,{})},{label:r()("super_admin"),key:"superAdmin",icon:a(p,{})},{label:r()("email"),key:"email",icon:a(ee,{})},{label:r()("created_at"),key:"createdAt",icon:a(M,{}),sortable:!0}]},get state(){return{isLoading:l.isFetching,isSuccess:l.isSuccess}},get options(){return{isSelectable:u(),allowRestore:!0}},callbacks:{restoreRows:async i=>{var h,_;const g=[];for(const o in i)i[o]&&((h=l.data)!=null&&h.data[o].id)&&g.push((_=l.data)==null?void 0:_.data[o].id);await b.action.mutateAsync({body:{ids:g}})}},children:({include:i,isSelectable:g,selected:h,setSelected:_})=>a(F,{get each(){var o;return((o=l.data)==null?void 0:o.data)||[]},children:(o,C)=>a(Se,{index:C,get user(){return o()},include:i,get selected(){return h[C]},rowTarget:t,options:{isSelectable:g},callbacks:{setSelected:_},get showingDeleted(){return e.state.showingDeleted}})})}),a(he,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().view,setOpen:i=>{t.setTrigger("view",i)}}}}),a(_e,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().update,setOpen:i=>{t.setTrigger("update",i)}}}}),a(fe,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().delete,setOpen:i=>{t.setTrigger("delete",i)}}}}),a(be,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().passwordReset,setOpen:i=>{t.setTrigger("passwordReset",i)}}}}),a(Pe,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().restore,setOpen:i=>{t.setTrigger("restore",i)}}}}),a(we,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().deletePermanently,setOpen:i=>{t.setTrigger("deletePermanently",i)}}}})]}})},ve=e=>{const[t,s]=w([]),[d,c]=w(""),[n,u]=w(""),[l,b]=w(""),[y,i]=w(""),[g,h]=w(!1),_=f.roles.useGetMultiple({queryParams:{include:{permissions:!1},perPage:-1},enabled:()=>e.state.open}),o=f.users.useCreateSingle({onSuccess:()=>{e.state.setOpen(!1)}}),C=m(()=>_.isLoading),K=m(()=>_.isError),V=m(()=>o.action.isPending);return a(L,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get fetchState(){return{isLoading:C(),isError:K()}},get mutateState(){return{isLoading:V(),errors:o.errors()}},callbacks:{onSubmit:()=>{var P;o.action.mutate({body:{email:y(),username:d(),firstName:n()||void 0,lastName:l()||void 0,superAdmin:(P=S.get.user)!=null&&P.superAdmin?g():void 0,roleIds:t().map(x=>x.value)}})},reset:()=>{o.reset(),c(""),u(""),b(""),i(""),h(!1),s([])}},get copy(){return{title:r()("create_user_panel_title"),description:r()("create_user_panel_description"),submit:r()("create")}},options:{padding:"24"},children:()=>[a(k,{id:"username",get value(){return d()},onChange:c,name:"username",type:"text",get copy(){return{label:r()("username")}},required:!0,get errors(){return T("username",o.errors)},theme:"full"}),a(U,{columns:2,get children(){return[a(k,{id:"firstName",get value(){return n()},onChange:u,name:"firstName",type:"text",get copy(){return{label:r()("first_name")}},noMargin:!0,get errors(){return T("firstName",o.errors)},theme:"full"}),a(k,{id:"lastName",get value(){return l()},onChange:b,name:"lastName",type:"text",get copy(){return{label:r()("last_name")}},noMargin:!0,get errors(){return T("lastName",o.errors)},theme:"full"})]}}),a(U,{columns:1,get children(){return a(k,{id:"email",get value(){return y()},onChange:i,name:"email",type:"text",get copy(){return{label:r()("email")}},noMargin:!0,required:!0,get errors(){return T("email",o.errors)},theme:"full"})}}),a(Q,{id:"roleIds",get values(){return t()},onChange:s,name:"roleIds",get copy(){return{label:r()("roles")}},get options(){var P;return((P=_.data)==null?void 0:P.data.map(x=>({value:x.id,label:x.name})))||[]},get errors(){return T("roleIds",o.errors)},theme:"full"}),a(D,{get when(){var P;return(P=S.get.user)==null?void 0:P.superAdmin},get children(){return a(G,{id:"superAdmin",get value(){return g()},onChange:P=>h(P),name:"superAdmin",get copy(){return{label:r()("is_super_admin")}},get errors(){return T("superAdmin",o.errors)},theme:"full"})}})]})},Je=()=>{const e=te(),t=ae({filters:{firstName:{value:"",type:"text"},lastName:{value:"",type:"text"},email:{value:"",type:"text"},username:{value:"",type:"text"}},sorts:{createdAt:void 0}},{singleSort:!0}),[s,d]=w(!1),[c,n]=w(!1);return a(re,{get slots(){return{header:a(ue,{get copy(){return{title:r()("users_route_title"),description:r()("users_route_description")}},get actions(){return{create:[{open:s(),setOpen:d,permission:S.get.hasPermission(["create_user"]).all,label:r()("add_user")}]}},get slots(){return{bottom:a(le,{searchParams:t,showingDeleted:c,setShowingDeleted:n,onRefresh:()=>{e.invalidateQueries({queryKey:["users.getMultiple"]})},get filters(){return[{label:r()("first_name"),key:"firstName",type:"text"},{label:r()("last_name"),key:"lastName",type:"text"},{label:r()("email"),key:"email",type:"text"},{label:r()("username"),key:"username",type:"text"}]},get sorts(){return[{label:r()("created_at"),key:"createdAt"}]},perPage:[]})}}})}},get children(){return[a(Te,{state:{searchParams:t,setOpenCreateUserPanel:d,showingDeleted:c}}),a(ve,{get state(){return{open:s(),setOpen:d}}})]}})};export{Je as default};
