import{b as p,V as C,Q as fe,X as D,f as _,Y as V,a as n,Z as v,d as F,_ as L,$ as j,a0 as K,y as te,x as O,T as r,e as P,t as q,w as B,s as ye,i as J,P as he,k as ve,r as pe,I as Ce,K as I,q as X,a1 as we,L as Y,E as xe,v as _e,W as Pe}from"./index-CQ3-BSEL.js";import{u as Ie}from"./useSearchParamsLocation-Sjso8rcp.js";import{T as Se,Q as ke}from"./Tr-Dh-rHsqH.js";import{S as De}from"./Standard-DQ0Jv3GR.js";import"./MediaFolderCard-DV834B6M.js";import{m as x,s as Te,P as T,c as ae,d as H,e as Ae,f as R,g as N,h as Oe,i as $,_ as ne,j as Ee,k as Me,l as Fe,o as h,p as Re,q as $e}from"./Tooltip-C4WAYcWb.js";import{u as Le}from"./useRowTarget-DdIL0a9L.js";import{P as je}from"./Paginated-uZRH6cV0.js";import{D as Ke}from"./ContentLocaleSelect-Cb-MBOKh.js";import{T as E,D as Z,a as qe}from"./DateCol-D5X8S346.js";import{P as S}from"./PillCol-CVehCi4c.js";import{P as He}from"./Panel-BJ5ATSyq.js";import{S as M}from"./SectionHeading-CnvfN_LE.js";import{D as z}from"./DetailsList-BHEhgC4b.js";import{J as Ne}from"./JSONPreview-Dl81wgPP.js";import{d as k}from"./date-helpers-BWhv-7yI.js";import{P as ee}from"./Pill-BBVDx-5p.js";import{C as re}from"./Confirmation-BG2UDkdk.js";import"./ActionDropdown-DU8N8G-B.js";import"./DateText-zHyly9WS.js";import"./ISASYZ5H-BKhR2em3.js";import"./ErrorMessage-BUQl5hDc.js";var We={};ne(We,{Collapsible:()=>Qe,Content:()=>W,Root:()=>Q,Trigger:()=>U});var oe=j();function A(){const e=L(oe);if(e===void 0)throw new Error("[kobalte]: `useCollapsibleContext` must be used within a `Collapsible.Root` component");return e}function W(e){const[t,l]=p(),a=A(),o=x({id:a.generateId("content")},e),[i,c]=C(o,["ref","id","style"]),{present:s}=Te({show:a.shouldMount,element:()=>t()??null}),[u,d]=p(0),[g,m]=p(0);let b=a.isOpen()||s();return fe(()=>{const f=requestAnimationFrame(()=>{b=!1});D(()=>{cancelAnimationFrame(f)})}),_(V(s,()=>{if(!t())return;t().style.transitionDuration="0s",t().style.animationName="none";const f=t().getBoundingClientRect();d(f.height),m(f.width),b||(t().style.transitionDuration="",t().style.animationName="")})),_(V(a.isOpen,f=>{!f&&t()&&(t().style.transitionDuration="",t().style.animationName="")},{defer:!0})),_(()=>D(a.registerContentId(i.id))),n(F,{get when(){return s()},get children(){return n(T,v({as:"div",ref(f){var G=H(l,i.ref);typeof G=="function"&&G(f)},get id(){return i.id},get style(){return ae({"--kb-collapsible-content-height":u()?`${u()}px`:void 0,"--kb-collapsible-content-width":g()?`${g()}px`:void 0},i.style)}},()=>a.dataset(),c))}})}function Q(e){const t=`collapsible-${K()}`,l=x({id:t},e),[a,o]=C(l,["open","defaultOpen","onOpenChange","disabled","forceMount"]),[i,c]=p(),s=Ae({open:()=>a.open,defaultOpen:()=>a.defaultOpen,onOpenChange:g=>{var m;return(m=a.onOpenChange)==null?void 0:m.call(a,g)}}),u=te(()=>({"data-expanded":s.isOpen()?"":void 0,"data-closed":s.isOpen()?void 0:"","data-disabled":a.disabled?"":void 0})),d={dataset:u,isOpen:s.isOpen,disabled:()=>a.disabled??!1,shouldMount:()=>a.forceMount||s.isOpen(),contentId:i,toggle:s.toggle,generateId:N(()=>o.id),registerContentId:R(c)};return n(oe.Provider,{value:d,get children(){return n(T,v({as:"div"},u,o))}})}function U(e){const t=A(),[l,a]=C(e,["onClick"]);return n(Oe,v({get"aria-expanded"(){return t.isOpen()},get"aria-controls"(){return te(()=>!!t.isOpen())()?t.contentId():void 0},get disabled(){return t.disabled()},onClick:i=>{$(i,l.onClick),t.toggle()}},()=>t.dataset(),a))}var Qe=Object.assign(Q,{Content:W,Trigger:U}),w={};ne(w,{Accordion:()=>Ue,Content:()=>se,Header:()=>de,Item:()=>ge,Root:()=>me,Trigger:()=>be});var le=j();function ie(){const e=L(le);if(e===void 0)throw new Error("[kobalte]: `useAccordionItemContext` must be used within a `Accordion.Item` component");return e}function se(e){const t=ie(),l=t.generateId("content"),a=x({id:l},e),[o,i]=C(a,["id","style"]);return _(()=>D(t.registerContentId(o.id))),n(W,v({role:"region",get"aria-labelledby"(){return t.triggerId()},get style(){return ae({"--kb-accordion-content-height":"var(--kb-collapsible-content-height)","--kb-accordion-content-width":"var(--kb-collapsible-content-width)"},o.style)}},i))}function de(e){const t=A();return n(T,v({as:"h3"},()=>t.dataset(),e))}var ce=j();function ue(){const e=L(ce);if(e===void 0)throw new Error("[kobalte]: `useAccordionContext` must be used within a `Accordion.Root` component");return e}function ge(e){const t=ue(),l=`${t.generateId("item")}-${K()}`,a=x({id:l},e),[o,i]=C(a,["value","disabled"]),[c,s]=p(),[u,d]=p(),g=()=>t.listState().selectionManager(),m=()=>g().isSelected(o.value),y={value:()=>o.value,triggerId:c,contentId:u,generateId:N(()=>i.id),registerTriggerId:R(s),registerContentId:R(d)};return n(le.Provider,{value:y,get children(){return n(Q,v({get open(){return m()},get disabled(){return o.disabled}},i))}})}function me(e){let t;const l=`accordion-${K()}`,a=x({id:l,multiple:!1,collapsible:!1,shouldFocusWrap:!0},e),[o,i]=C(a,["id","ref","value","defaultValue","onChange","multiple","collapsible","shouldFocusWrap","onKeyDown","onMouseDown","onFocusIn","onFocusOut"]),[c,s]=p([]),{DomCollectionProvider:u}=Ee({items:c,onItemsChange:s}),d=Me({selectedKeys:()=>o.value,defaultSelectedKeys:()=>o.defaultValue,onSelectionChange:y=>{var b;return(b=o.onChange)==null?void 0:b.call(o,Array.from(y))},disallowEmptySelection:()=>!o.multiple&&!o.collapsible,selectionMode:()=>o.multiple?"multiple":"single",dataSource:c});d.selectionManager().setFocusedKey("item-1");const g=Fe({selectionManager:()=>d.selectionManager(),collection:()=>d.collection(),disallowEmptySelection:()=>d.selectionManager().disallowEmptySelection(),shouldFocusWrap:()=>o.shouldFocusWrap,disallowTypeAhead:!0,allowsTabNavigation:!0},()=>t),m={listState:()=>d,generateId:N(()=>o.id)};return n(u,{get children(){return n(ce.Provider,{value:m,get children(){return n(T,v({as:"div",get id(){return o.id},ref(y){var b=H(f=>t=f,o.ref);typeof b=="function"&&b(y)},get onKeyDown(){return h([o.onKeyDown,g.onKeyDown])},get onMouseDown(){return h([o.onMouseDown,g.onMouseDown])},get onFocusIn(){return h([o.onFocusIn])},get onFocusOut(){return h([o.onFocusOut,g.onFocusOut])}},i))}})}})}function be(e){let t;const l=ue(),a=ie(),o=A(),i=a.generateId("trigger"),c=x({id:i},e),[s,u]=C(c,["ref","onPointerDown","onPointerUp","onClick","onKeyDown","onMouseDown","onFocus"]);Re({getItem:()=>({ref:()=>t,type:"item",key:a.value(),textValue:"",disabled:o.disabled()})});const d=$e({key:()=>a.value(),selectionManager:()=>l.listState().selectionManager(),disabled:()=>o.disabled(),shouldSelectOnPressUp:!0},()=>t),g=m=>{["Enter"," "].includes(m.key)&&m.preventDefault(),$(m,s.onKeyDown),$(m,d.onKeyDown)};return _(()=>D(a.registerTriggerId(u.id))),n(U,v({ref(m){var y=H(b=>t=b,s.ref);typeof y=="function"&&y(m)},get"data-key"(){return d.dataKey()},get onPointerDown(){return h([s.onPointerDown,d.onPointerDown])},get onPointerUp(){return h([s.onPointerUp,d.onPointerUp])},get onClick(){return h([s.onClick,d.onClick])},onKeyDown:g,get onMouseDown(){return h([s.onMouseDown,d.onMouseDown])},get onFocus(){return h([s.onFocus,d.onFocus])}},u))}var Ue=Object.assign(me,{Content:se,Header:de,Item:ge,Trigger:be});const Ge=e=>n(Se,{get index(){return e.index},get selected(){return e.selected},get options(){return e.options},get callbacks(){return e.callbacks},get actions(){return[{label:r()("preview"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.email.id),e.rowTarget.setTrigger("preview",!0)},permission:O.get.hasPermission(["read_email"]).all},{label:r()("resend"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.email.id),e.rowTarget.setTrigger("resend",!0)},permission:O.get.hasPermission(["send_email"]).all,actionExclude:!0},{label:r()("delete"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.email.id),e.rowTarget.setTrigger("delete",!0)},permission:O.get.hasPermission(["delete_email"]).all,actionExclude:!0}]},get children(){return[n(S,{get text(){return e.email.currentStatus},get theme(){return e.email.currentStatus==="sent"||e.email.currentStatus==="delivered"?"primary":e.email.currentStatus==="failed"?"red":"grey"},get options(){return{include:e==null?void 0:e.include[0]}}}),n(E,{get text(){return e.email.mailDetails.subject},get options(){return{include:e==null?void 0:e.include[1],maxLines:2}}}),n(S,{get text(){return e.email.mailDetails.template},get options(){return{include:e==null?void 0:e.include[2]}}}),n(E,{get text(){return e.email.mailDetails.to},get options(){return{include:e==null?void 0:e.include[3],maxLines:1}}}),n(E,{get text(){return e.email.mailDetails.from.address},get options(){return{include:e==null?void 0:e.include[4],maxLines:1}}}),n(S,{get text(){return e.email.attemptCount||0},theme:"grey",get options(){return{include:e==null?void 0:e.include[5]}}}),n(S,{get text(){return e.email.type},theme:"grey",get options(){return{include:e==null?void 0:e.include[6]}}}),n(Z,{get date(){return e.email.createdAt},get options(){return{include:e==null?void 0:e.include[7]}}}),n(Z,{get date(){return e.email.lastAttemptedAt},get options(){return{include:e==null?void 0:e.include[8]}}})]}});var Ve=q('<div class="border border-border rounded-md overflow-hidden mb-4"><iframe class="w-full h-96"title=Preview>'),Be=q("<div>"),Je=q("<span class=text-body>");const Xe=e=>{const t=P.email.useGetSingle({queryParams:{location:{emailId:e.id}},enabled:()=>!!e.id()}),l=a=>a==="sent"||a==="delivered"?"primary":a==="failed"?"red":"grey";return n(He,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get fetchState(){return{isLoading:t.isLoading,isError:t.isError}},options:{padding:"24",hideFooter:!0},get copy(){return{title:r()("preview_email_panel_title"),description:r()("preview_email_panel_description")}},children:()=>[(()=>{var a=Ve(),o=a.firstChild;return B(()=>{var i;return ye(o,"srcdoc",((i=t.data)==null?void 0:i.data.html)||"")}),a})(),n(M,{get title(){return r()("details")}}),n(z,{type:"text",get items(){var a,o,i,c,s,u,d,g;return[{label:r()("subject"),value:((a=t.data)==null?void 0:a.data.mailDetails.subject)??void 0},{label:r()("template"),value:((o=t.data)==null?void 0:o.data.mailDetails.template)??void 0},{label:r()("to"),value:((i=t.data)==null?void 0:i.data.mailDetails.to)??void 0},{label:r()("from"),value:((c=t.data)==null?void 0:c.data.mailDetails.from.address)??void 0},{label:r()("status"),value:((s=t.data)==null?void 0:s.data.currentStatus)??void 0},{label:r()("type"),value:((u=t.data)==null?void 0:u.data.type)??void 0},{label:r()("sent_count"),value:((d=t.data)==null?void 0:d.data.attemptCount)??0},{label:r()("last_attempt_at"),value:k.formatDate((g=t.data)==null?void 0:g.data.lastAttemptedAt)}]}}),n(F,{get when(){var a;return(a=t.data)==null?void 0:a.data.data},get children(){return[n(M,{get title(){return r()("template_data")}}),(()=>{var a=Be();return J(a,n(Ne,{get title(){return r()("template_data")},get json(){var o;return((o=t.data)==null?void 0:o.data.data)||{}}})),B(()=>{var o,i,c;return he(a,ve({"mb-4":((i=(o=t.data)==null?void 0:o.data.transactions)==null?void 0:i.length)&&((c=t.data)==null?void 0:c.data.transactions.length)>0}))}),a})()]}}),n(F,{get when(){var a,o;return((a=t.data)==null?void 0:a.data.transactions)&&((o=t.data)==null?void 0:o.data.transactions.length)>0},get children(){return[n(M,{get title(){return r()("transactions")}}),n(w.Root,{multiple:!0,class:"flex flex-col gap-2.5",get children(){return n(pe,{get each(){var a;return(a=t.data)==null?void 0:a.data.transactions},children:(a,o)=>n(w.Item,{get value(){return`tx-${o()}`},class:"border border-border rounded-md overflow-hidden",get children(){return[n(w.Header,{get children(){return n(w.Trigger,{class:"w-full flex items-center justify-between text-sm font-medium text-title bg-card-base hover:bg-card-hover p-4 focus:outline-hidden focus:ring-1 ring-primary-base duration-200 transition-colors",get children(){return[n(ee,{get theme(){return l(a.deliveryStatus)},get children(){return a.deliveryStatus}}),(()=>{var i=Je();return J(i,()=>k.formatDate(a.createdAt??null)),i})()]}})}}),n(w.Content,{class:"p-4 bg-card-base border-t border-border",get children(){return n(z,{type:"text",get items(){return[{label:r()("status"),value:n(ee,{get theme(){return l(a.deliveryStatus)},get children(){return a.deliveryStatus}})},{label:r()("identifier"),value:a.strategyIdentifier},{label:r()("created_at"),value:k.formatDate(a.createdAt)},{label:r()("updated_at"),value:k.formatDate(a.updatedAt)}]}})}})]}})})}})]}})]})},Ye=e=>{const t=P.email.useDeleteSingle({onSuccess:()=>{e.state.setOpen(!1)}});return n(re,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var l;return{title:r()("delete_email_modal_title"),description:r()("delete_email_modal_description"),error:(l=t.errors())==null?void 0:l.message}},callbacks:{onConfirm:()=>{const l=e.id();if(!l)return console.error("No id provided");t.action.mutate({id:l})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})},Ze=e=>{const t=P.email.useResendSingle({onSuccess:()=>{e.state.setOpen(!1)}});return n(re,{theme:"primary",get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var l;return{title:r()("resend_email_modal_title"),description:r()("resend_email_modal_description"),error:(l=t.errors())==null?void 0:l.message}},callbacks:{onConfirm:()=>{const l=e.id();if(!l)return console.error("No id provided");t.action.mutate({id:l})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})},ze=e=>{const t=Le({triggers:{preview:!1,delete:!1,resend:!1}}),l=P.email.useGetMultiple({queryParams:{queryString:e.state.searchParams.getQueryString},enabled:()=>e.state.searchParams.getSettled()});return n(Ke,{get state(){var a;return{isError:l.isError,isSuccess:l.isSuccess,isEmpty:((a=l.data)==null?void 0:a.data.length)===0,searchParams:e.state.searchParams}},get slot(){return{footer:n(je,{get state(){var a;return{searchParams:e.state.searchParams,meta:(a=l.data)==null?void 0:a.meta}},options:{padding:"24"}})}},get copy(){return{noEntries:{title:r()("no_emails"),description:r()("no_emails_description")}}},get children(){return[n(qe,{key:"emails.list",get rows(){var a;return((a=l.data)==null?void 0:a.data.length)||0},get searchParams(){return e.state.searchParams},get head(){return[{label:r()("status"),key:"status",icon:n(I,{})},{label:r()("subject"),key:"subject",icon:n(I,{})},{label:r()("template"),key:"template",icon:n(I,{})},{label:r()("to"),key:"to",icon:n(X,{})},{label:r()("from"),key:"from",icon:n(X,{})},{label:r()("sent_count"),key:"attemptCount",icon:n(we,{}),sortable:!0},{label:r()("type"),key:"type",icon:n(I,{})},{label:r()("first_attempt"),key:"createdAt",icon:n(Y,{}),sortable:!0},{label:r()("last_attempt"),key:"lastAttemptedAt",icon:n(Y,{}),sortable:!0}]},get state(){return{isLoading:l.isFetching,isSuccess:l.isSuccess}},options:{isSelectable:!1},children:({include:a,isSelectable:o,selected:i,setSelected:c})=>n(Ce,{get each(){var s;return((s=l.data)==null?void 0:s.data)||[]},children:(s,u)=>n(Ge,{index:u,get email(){return s()},include:a,get selected(){return i[u]},rowTarget:t,options:{isSelectable:o},callbacks:{setSelected:c}})})}),n(Xe,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().preview,setOpen:a=>{t.setTrigger("preview",a)}}}}),n(Ye,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().delete,setOpen:a=>{t.setTrigger("delete",a)}}}}),n(Ze,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().resend,setOpen:a=>{t.setTrigger("resend",a)}}}})]}})},xt=()=>{const e=xe(),t=Ie({filters:{toAddress:{value:"",type:"text"},subject:{value:"",type:"text"},template:{value:"",type:"text"},currentStatus:{value:"",type:"array"},type:{value:"",type:"array"}},sorts:{createdAt:void 0,lastAttemptedAt:"desc",attemptCount:void 0}},{singleSort:!0}),l=P.settings.useGetSettings({queryParams:{}});return n(Pe,{get slots(){return{topBar:n(_e,{style:"layout",get alerts(){var a;return[{type:"warning",message:r()("email_support_config_stategy_error"),show:((a=l.data)==null?void 0:a.data.media.enabled)===!1}]}}),header:n(De,{get copy(){return{title:r()("email_route_title"),description:r()("email_route_description")}},get slots(){return{bottom:n(ke,{searchParams:t,onRefresh:()=>{e.invalidateQueries({queryKey:["email.getMultiple"]})},get filters(){return[{label:r()("to"),key:"toAddress",type:"text"},{label:r()("subject"),key:"subject",type:"text"},{label:r()("template"),key:"template",type:"text"},{label:r()("status"),key:"currentStatus",type:"multi-select",options:[{label:r()("sent"),value:"sent"},{label:r()("delivered"),value:"delivered"},{label:r()("failed"),value:"failed"},{label:r()("delayed"),value:"delayed"},{label:r()("complained"),value:"complained"},{label:r()("bounced"),value:"bounced"},{label:r()("clicked"),value:"clicked"},{label:r()("opened"),value:"opened"},{label:r()("scheduled"),value:"scheduled"}]},{label:r()("type"),key:"type",type:"multi-select",options:[{label:r()("internal"),value:"internal"},{label:r()("external"),value:"external"}]}]},get sorts(){return[{label:r()("attempt_count"),key:"attemptCount"},{label:r()("last_attempt_at"),key:"lastAttemptedAt"},{label:r()("created_at"),key:"createdAt"}]},perPage:[]})}}})}},get children(){return n(ze,{state:{searchParams:t}})}})};export{xt as default};
