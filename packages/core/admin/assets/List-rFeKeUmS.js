import{b as S,a as n,y,e as x,T as r,z as re,B as k,f as j,r as K,d as R,t as N,i as L,C as pe,A as Y,D as ae,M as V,h as ne,w as he,s as fe,k as ye,E as _e,G as be,x as se,v as ve,W as Fe}from"./index-CQ3-BSEL.js";import{u as we}from"./useSearchParamsLocation-Sjso8rcp.js";import{S as Ie}from"./Standard-DQ0Jv3GR.js";import{u as Ce}from"./useRowTarget-DdIL0a9L.js";import{P as Se}from"./Paginated-uZRH6cV0.js";import{D as Pe}from"./ContentLocaleSelect-Cb-MBOKh.js";import{G as oe}from"./Grid-OY6rmIwE.js";import{F as xe,m as U,D as Te,a as Ee,M as Le,b as Oe,c as ke,d as De}from"./MediaFolderCard-DV834B6M.js";import{g as H,a as ie}from"./error-helpers-D9jUdhyT.js";import{S as $e,a as J,I as G,B as de}from"./Tooltip-C4WAYcWb.js";import{d as Q}from"./date-helpers-BWhv-7yI.js";import{P as X}from"./Panel-BJ5ATSyq.js";import{S as W}from"./SectionHeading-CnvfN_LE.js";import{D as ge}from"./DetailsList-BHEhgC4b.js";import{A as Me,M as Ue,Q as Ae}from"./Tr-Dh-rHsqH.js";import{C as z}from"./Confirmation-BG2UDkdk.js";import{C as Re}from"./ActionDropdown-DU8N8G-B.js";import"./ISASYZ5H-BKhR2em3.js";import"./ErrorMessage-BUQl5hDc.js";import"./Pill-BBVDx-5p.js";var He=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],B=(e,t)=>{var s="";for(let o=1;o<=t;o++){let u=Math.floor(e)/Math.pow(83,t-o)%83;s+=He[Math.floor(u)]}return s},Z=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},ee=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},Ne=e=>e<0?-1:1,te=(e,t)=>Ne(e)*Math.pow(Math.abs(e),t),le=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},ce=4,qe=(e,t,s,o)=>{let u=0,i=0,_=0,I=t*ce;for(let p=0;p<t;p++){let m=ce*p;for(let l=0;l<s;l++){let g=m+l*I,b=o(p,l);u+=b*Z(e[g]),i+=b*Z(e[g+1]),_+=b*Z(e[g+2])}}let h=1/(t*s);return[u*h,i*h,_*h]},Ge=e=>{let t=ee(e[0]),s=ee(e[1]),o=ee(e[2]);return(t<<16)+(s<<8)+o},ze=(e,t)=>{let s=Math.floor(Math.max(0,Math.min(18,Math.floor(te(e[0]/t,.5)*9+9.5)))),o=Math.floor(Math.max(0,Math.min(18,Math.floor(te(e[1]/t,.5)*9+9.5)))),u=Math.floor(Math.max(0,Math.min(18,Math.floor(te(e[2]/t,.5)*9+9.5))));return s*19*19+o*19+u},Be=(e,t,s,o,u)=>{if(o<1||o>9||u<1||u>9)throw new le("BlurHash must have between 1 and 9 components");if(t*s*4!==e.length)throw new le("Width and height must match the pixels array");let i=[];for(let l=0;l<u;l++)for(let g=0;g<o;g++){let b=g==0&&l==0?1:2,v=qe(e,t,s,(F,C)=>b*Math.cos(Math.PI*g*F/t)*Math.cos(Math.PI*l*C/s));i.push(v)}let _=i[0],I=i.slice(1),h="",p=o-1+(u-1)*9;h+=B(p,1);let m;if(I.length>0){let l=Math.max(...I.map(b=>Math.max(...b))),g=Math.floor(Math.max(0,Math.min(82,Math.floor(l*166-.5))));m=(g+1)/166,h+=B(g,1)}else m=1,h+=B(0,1);return h+=B(Ge(_),4),I.forEach(l=>{h+=B(ze(l,m),2)}),h},je=Be;const Ke=e=>{const[t,s]=S(null),[o,u]=S(!1),[i,_]=S(e.currentFile);return{getFile:t,setGetFile:s,getRemovedCurrent:o,setGetRemovedCurrent:u,getCurrentFile:i,setCurrentFile:_,getMimeType:()=>{var m;return(m=t())==null?void 0:m.type},getFileName:()=>{var m;return(m=t())==null?void 0:m.name},getImageMeta:async()=>{const m=t();if(!m||!m.type.startsWith("image/"))return null;try{const l=new Image,g=document.createElement("canvas"),b=g.getContext("2d");if(!b)return console.warn("Could not get canvas context for image metadata extraction"),null;await new Promise((f,a)=>{l.onload=()=>f(),l.onerror=()=>a(new Error("Failed to load image")),l.src=URL.createObjectURL(m)}),g.width=l.width,g.height=l.height,b.drawImage(l,0,0);const v=b.getImageData(0,0,l.width,l.height),F=64,C=document.createElement("canvas"),E=C.getContext("2d");if(!E)throw new Error("Could not get blur canvas context");C.width=F,C.height=Math.round(l.height/l.width*F),E.drawImage(l,0,0,C.width,C.height);const D=E.getImageData(0,0,C.width,C.height),A=je(D.data,C.width,C.height,4,4),$=await new xe().getColorAsync(g);return URL.revokeObjectURL(l.src),{width:l.width,height:l.height,blurHash:A,averageColor:$.rgba,isDark:$.isDark,isLight:$.isLight}}catch(l){return console.error("Error extracting image metadata:",l),null}},reset:()=>{s(null),u(!1),_(e.currentFile)},Render:()=>n($e,{get state(){return{value:t(),setValue:s,removedCurrent:o(),setRemovedCurrent:u}},get currentFile(){return i()},get disableRemoveCurrent(){return e.disableRemoveCurrent},get id(){return e.id},get name(){return e.name},get copy(){return e.copy},get accept(){return e.accept},get required(){return e.required},get disabled(){return e.disabled},get errors(){return y(()=>!!e.errors)()?H(e.name,e.errors):void 0},get noMargin(){return e.noMargin}})}},Ve=()=>{const[e,t]=S([]),[s,o]=S([]),[u,i]=S(),[_,I]=S(void 0),[h,p]=S(),[m,l]=S(),[g,b]=S(),[v,F]=S(!1),C=x.media.useCreateSingle(),E=x.media.useGetPresignedUrl({onSuccess:a=>{i(a.data.key),p(a.data.url),l(a.data.headers)}}),D=async(a,c)=>{await E.action.mutateAsync({body:{fileName:a,mimeType:c}})},A=async a=>{var c;try{F(!0);const d=u(),w=h();if(!d||!w)return b({status:400,name:r()("media_upload_error"),message:r()("media_no_key_or_presigned_url")}),null;const P=await fetch(w,{method:"PUT",body:a,headers:{"content-type":a.type,...m()}});let T="";if((c=P.headers.get("content-type"))!=null&&c.includes("application/json")){const O=await P.json();T=(O==null?void 0:O.message)||""}return P.ok?d:(b({status:P.status,name:r()("media_upload_error"),message:r()("media_upload_error_description"),errors:{body:{file:{message:T||""}}}}),null)}catch(d){return b({status:500,name:r()("media_upload_error"),message:d instanceof Error?d.message:r()("media_upload_error_description")}),null}finally{F(!1)}},M=async(a,c)=>{let d=u();if(a){await D(a.name,a.type);const w=await A(a);if(!w)return!1;d=w}return await C.action.mutateAsync({key:d,fileName:a==null?void 0:a.name,title:e(),alt:s(),folderId:_()??null,width:c==null?void 0:c.width,height:c==null?void 0:c.height,blurHash:c==null?void 0:c.blurHash,averageColor:c==null?void 0:c.averageColor,isDark:c==null?void 0:c.isDark,isLight:c==null?void 0:c.isLight}),!0},$=y(()=>C.action.isPending||E.action.isPending||v()),f=y(()=>C.errors()||E.errors()||g());return{createMedia:M,setTitle:t,setAlt:o,setFolderId:I,errors:f,isLoading:$,state:{title:e,alt:s,key:u,folderId:_},reset:()=>{t([]),o([]),i(void 0),I(void 0),p(void 0),b(),C.reset()}}},Qe=e=>{const[t,s]=S([]),[o,u]=S([]),[i,_]=S(),[I,h]=S(void 0),[p,m]=S(),[l,g]=S(),[b,v]=S(),[F,C]=S(!1),E=x.media.useUpdateSingle(),D=x.media.useGetPresignedUrl({onSuccess:c=>{_(c.data.key),m(c.data.url),g(c.data.headers)}}),A=async(c,d)=>{await D.action.mutateAsync({body:{fileName:c,mimeType:d}})},M=async c=>{var d;try{C(!0);const w=i(),P=p();if(!w||!P)return v({status:400,name:r()("media_upload_error"),message:r()("media_no_key_or_presigned_url")}),null;const T=await fetch(P,{method:"PUT",body:c,headers:{"content-type":c.type,...l()}});let O="";if((d=T.headers.get("content-type"))!=null&&d.includes("application/json")){const q=await T.json();O=(q==null?void 0:q.message)||""}return T.ok?w:(v({status:T.status,name:r()("media_upload_error"),message:r()("media_upload_error_description"),errors:{body:{file:{message:O||""}}}}),null)}catch(w){return v({status:500,name:r()("media_upload_error"),message:w instanceof Error?w.message:r()("media_upload_error_description")}),null}finally{C(!1)}},$=async(c,d)=>{if(!e())return!1;let w=i();if(c){await A(c.name,c.type);const P=await M(c);if(!P)return!1;w=P}return await E.action.mutateAsync({id:e(),body:{key:w,fileName:c==null?void 0:c.name,title:t(),alt:o(),folderId:I()??null,width:d==null?void 0:d.width,height:d==null?void 0:d.height,blurHash:d==null?void 0:d.blurHash,averageColor:d==null?void 0:d.averageColor,isDark:d==null?void 0:d.isDark,isLight:d==null?void 0:d.isLight}}),!0},f=y(()=>E.action.isPending||D.action.isPending||F()),a=y(()=>E.errors()||D.errors()||b());return{updateMedia:$,setTitle:s,setAlt:u,setFolderId:h,errors:a,isLoading:f,state:{title:t,alt:o,key:i,folderId:I},reset:()=>{s([]),u([]),_(void 0),h(void 0),m(void 0),v(),E.reset()}}},me=e=>{const t=y(()=>e.id===void 0?"create":"update"),s=Ve(),o=e.id?Qe(e.id):null,u=Ke({id:"file",disableRemoveCurrent:!0,name:"file",required:!0,errors:t()==="create"?s.errors:o==null?void 0:o.errors,noMargin:!1}),i=x.media.useGetSingle({queryParams:{location:{id:e.id}},enabled:()=>t()==="update"&&e.state.open}),_=x.mediaFolders.useGetHierarchy({queryParams:{}}),I=y(()=>re.get.locales),h=y(()=>{var f;return u.getFile()!==null?k.getMediaType(u.getMimeType())==="image":t()==="create"?!1:((f=i.data)==null?void 0:f.data.type)==="image"}),p=y(()=>{var c;const a=(((c=_.data)==null?void 0:c.data)||[]).slice().sort((d,w)=>{var P,T;return(((P=d.meta)==null?void 0:P.order)??0)-(((T=w.meta)==null?void 0:T.order)??0)}).map(d=>{var P,T,O;let w=((P=d.meta)==null?void 0:P.label)??d.title;return(T=d.meta)!=null&&T.level&&((O=d.meta)==null?void 0:O.level)>0&&(w=`| ${w}`),{value:d.id,label:w}});return[{value:void 0,label:r()("no_folder")},...a]}),m=y(()=>{const f=e.state.parentFolderId();if(!(f===void 0||f===""))return typeof f=="string"?Number.parseInt(f,10):f}),l=y(()=>t()==="create"?s.isLoading():(o==null?void 0:o.isLoading())||!1),g=y(()=>t()==="create"?s.errors():o==null?void 0:o.errors()),b=y(()=>{var c,d;const f=(c=H("title",g))==null?void 0:c.children,a=(d=H("alt",g))==null?void 0:d.children;return f&&f.length>0||a&&a.length>0}),v=y(()=>t()==="create"?s:o),F=y(()=>{var f;return(f=v())==null?void 0:f.state}),C=y(()=>{var w,P,T;const f=F(),{changed:a,data:c}=k.updateData({key:void 0,title:((w=i.data)==null?void 0:w.data.title)||[],alt:((P=i.data)==null?void 0:P.data.alt)||[],folderId:((T=i.data)==null?void 0:T.data.folderId)??null},{key:f==null?void 0:f.key(),title:f==null?void 0:f.title(),alt:f==null?void 0:f.alt(),folderId:f==null?void 0:f.folderId()});let d=a;return u.getFile()&&(d=!0),{changed:d,data:c}}),E=y(()=>t()==="create"?u.getFile()===null:!C().changed),D=y(()=>t()==="create"?{title:r()("create_media_panel_title"),description:r()("create_media_panel_description"),submit:r()("create")}:{title:r()("update_media_panel_title"),description:r()("update_media_panel_description"),submit:r()("update")}),A=y(()=>t()==="create"?{isLoading:_.isLoading,isError:_.isError}:{isLoading:i.isLoading||_.isLoading,isError:i.isError||_.isError}),M=f=>{var c;const a=(c=H("translations",g))==null?void 0:c.children;if(a)return a[f]},$=async()=>{const f=await u.getImageMeta(),a=t()==="create"?s.createMedia:o==null?void 0:o.updateMedia;!a||!await a(u.getFile(),f)||e.state.setOpen(!1)};return j(()=>{var f,a,c,d,w,P;i.isSuccess&&t()==="update"&&(o==null||o.setTitle(((f=i.data)==null?void 0:f.data.title)||[]),o==null||o.setAlt(((a=i.data)==null?void 0:a.data.alt)||[]),o==null||o.setFolderId(((c=i.data)==null?void 0:c.data.folderId)??null),u.reset(),u.setCurrentFile({name:i.data.data.key,url:(d=i.data)!=null&&d.data.url?((w=i.data)==null?void 0:w.data.type)==="image"?`${i.data.data.url}?preset=thumbnail&format=webp`:i.data.data.url:void 0,type:((P=i.data)==null?void 0:P.data.type)||void 0}))}),j(()=>{if(t()==="create"){const f=m();s.state.folderId()!==f&&s.setFolderId(f)}}),n(X,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get fetchState(){return A()},get mutateState(){return{isLoading:l(),errors:g(),isDisabled:E()}},callbacks:{onSubmit:$,reset:()=>{s.reset(),o==null||o.reset(),u.reset()}},get copy(){return D()},get langauge(){return{contentLocale:!0,hascontentLocaleError:b(),useDefaultcontentLocale:t()==="create"}},options:{padding:"24"},children:f=>[n(u.Render,{}),n(W,{get title(){return r()("details")}}),n(J,{id:"media-folder",get value(){var a;return((a=F())==null?void 0:a.folderId())??void 0},onChange:a=>{var d;const c=typeof a=="string"?Number.parseInt(a,10):a;(d=v())==null||d.setFolderId(c)},name:"media-folder",get options(){return p()},get copy(){return{label:r()("folder")}},required:!1,get errors(){return H("folderId",g())},noMargin:!1,noClear:!0,theme:"full"}),n(K,{get each(){return I()},children:(a,c)=>n(R,{get when(){return a.code===(f==null?void 0:f.contentLocale())},get children(){return[n(G,{get id(){return`name-${a.code}`},get value(){var d;return k.getTranslation((d=F())==null?void 0:d.title(),a.code)||""},onChange:d=>{var w;k.updateTranslation((w=v())==null?void 0:w.setTitle,{localeCode:a.code,value:d})},get name(){return`name-${a.code}`},type:"text",get copy(){return{label:r()("name_lang",{code:a.code})}},get errors(){var d;return ie((d=M(c()))==null?void 0:d.name)},autoComplete:"off",theme:"full"}),n(R,{get when(){return h()},get children(){return n(G,{get id(){return`alt-${a.code}`},get value(){var d;return k.getTranslation((d=F())==null?void 0:d.alt(),a.code)||""},onChange:d=>{var w;k.updateTranslation((w=v())==null?void 0:w.setAlt,{localeCode:a.code,value:d})},get name(){return`alt-${a.code}`},type:"text",get copy(){return{label:r()("alt_lang",{code:a.code})}},get errors(){var d;return ie((d=M(c()))==null?void 0:d.alt)},theme:"full"})}})]}})}),n(R,{get when(){return e.id!==void 0},get children(){return[n(W,{get title(){return r()("meta")}}),n(ge,{type:"text",get items(){var a,c,d,w,P,T,O,q;return[{label:r()("file_size"),value:k.bytesToSize(((a=i.data)==null?void 0:a.data.meta.fileSize)??0)},{label:r()("dimensions"),value:`${(c=i.data)==null?void 0:c.data.meta.width} x ${(d=i.data)==null?void 0:d.data.meta.height}`,show:((w=i.data)==null?void 0:w.data.type)==="image"},{label:r()("extension"),value:(P=i.data)==null?void 0:P.data.meta.extension},{label:r()("mime_type"),value:(T=i.data)==null?void 0:T.data.meta.mimeType},{label:r()("created_at"),value:Q.formatDate((O=i.data)==null?void 0:O.data.createdAt)},{label:r()("updated_at"),value:Q.formatDate((q=i.data)==null?void 0:q.data.updatedAt)}]}})]}})]})},We=e=>{const t=x.media.useGetSingle({queryParams:{location:{id:e.id}},enabled:()=>e.state.open}),s=x.mediaFolders.useGetHierarchy({queryParams:{}}),o=y(()=>re.get.locales),u=y(()=>{var p;return((p=t.data)==null?void 0:p.data.type)==="image"}),i=y(()=>{var l;const m=(((l=s.data)==null?void 0:l.data)||[]).slice().sort((g,b)=>{var v,F;return(((v=g.meta)==null?void 0:v.order)??0)-(((F=b.meta)==null?void 0:F.order)??0)}).map(g=>{var v,F,C;let b=((v=g.meta)==null?void 0:v.label)??g.title;return(F=g.meta)!=null&&F.level&&((C=g.meta)==null?void 0:C.level)>0&&(b=`| ${b}`),{value:g.id,label:b}});return[{value:void 0,label:r()("no_folder")},...m]}),_=y(()=>!1),I=y(()=>({title:r()("view_media_panel_title"),description:r()("view_media_panel_description")})),h=y(()=>({isLoading:t.isLoading||s.isLoading,isError:t.isError||s.isError}));return n(X,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get fetchState(){return h()},options:{padding:"24",hideFooter:!0},callbacks:{reset:()=>{}},get copy(){return I()},get langauge(){return{contentLocale:!0,hascontentLocaleError:_(),useDefaultcontentLocale:!1}},children:p=>[n(Me,{ratio:"16:9",innerClass:"overflow-hidden mb-4 rounded-md",get children(){return n(R,{get when(){var m;return(m=t.data)==null?void 0:m.data},keyed:!0,children:m=>n(Ue,{get media(){return{type:m.type,url:m.url}},get alt(){return k.getTranslation(m.alt,p==null?void 0:p.contentLocale())||k.getTranslation(m.title,p==null?void 0:p.contentLocale())||""}})})}}),n(W,{get title(){return r()("details")}}),n(J,{id:"media-folder",get value(){var m;return((m=t.data)==null?void 0:m.data.folderId)??void 0},onChange:()=>{},name:"media-folder",get options(){return i()},get copy(){return{label:r()("folder")}},required:!1,errors:void 0,noMargin:!1,noClear:!0,disabled:!0,theme:"full"}),n(K,{get each(){return o()},children:m=>n(R,{get when(){return m.code===(p==null?void 0:p.contentLocale())},get children(){return[n(G,{get id(){return`name-${m.code}`},get value(){var l;return k.getTranslation((l=t.data)==null?void 0:l.data.title,m.code)||""},onChange:()=>{},get name(){return`name-${m.code}`},type:"text",get copy(){return{label:r()("name_lang",{code:m.code})}},errors:void 0,autoComplete:"off",disabled:!0,theme:"full"}),n(R,{get when(){return u()},get children(){return n(G,{get id(){return`alt-${m.code}`},get value(){var l;return k.getTranslation((l=t.data)==null?void 0:l.data.alt,m.code)||""},onChange:()=>{},get name(){return`alt-${m.code}`},type:"text",get copy(){return{label:r()("alt_lang",{code:m.code})}},errors:void 0,disabled:!0,theme:"full"})}})]}})}),n(R,{get when(){return e.id!==void 0},get children(){return[n(W,{get title(){return r()("meta")}}),n(ge,{type:"text",get items(){var m,l,g,b,v,F,C,E;return[{label:r()("file_size"),value:k.bytesToSize(((m=t.data)==null?void 0:m.data.meta.fileSize)??0)},{label:r()("dimensions"),value:`${(l=t.data)==null?void 0:l.data.meta.width} x ${(g=t.data)==null?void 0:g.data.meta.height}`,show:((b=t.data)==null?void 0:b.data.type)==="image"},{label:r()("extension"),value:(v=t.data)==null?void 0:v.data.meta.extension},{label:r()("mime_type"),value:(F=t.data)==null?void 0:F.data.meta.mimeType},{label:r()("created_at"),value:Q.formatDate((C=t.data)==null?void 0:C.data.createdAt)},{label:r()("updated_at"),value:Q.formatDate((E=t.data)==null?void 0:E.data.updatedAt)}]}})]}})]})},Je=e=>{const t=x.media.useDeleteSingle({onSuccess:()=>{e.state.setOpen(!1)}});return n(z,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var s;return{title:r()("delete_media_modal_title"),description:r()("delete_media_modal_description"),error:(s=t.errors())==null?void 0:s.message}},callbacks:{onConfirm:()=>{const s=e.id();if(!s)return console.error("No id provided");t.action.mutate({id:s})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})},Xe=e=>{const t=x.media.useDeleteProcessedImages({onSuccess:()=>{e.state.setOpen(!1)}});return n(z,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var s;return{title:r()("clear_processed_images_modal_title"),description:r()("clear_processed_images_modal_description"),error:(s=t.errors())==null?void 0:s.message}},callbacks:{onConfirm:()=>{const s=e.id();if(!s)return console.error("No id provided");t.action.mutate({id:s})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})};var Ye=N('<div class="bg-card-base p-4 rounded-md border border-border">');const Ze=e=>{const[t,s]=S(!1),o=x.media.useDeleteBatch({onSuccess:()=>{e.state.setOpen(!1),U.get.reset()}});return n(z,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:o.action.isPending,isError:o.action.isError}},get copy(){var u;return{title:r()("delete_media_batch_modal_title"),description:r()("delete_media_batch_modal_description"),error:(u=o.errors())==null?void 0:u.message}},callbacks:{onConfirm:()=>{o.action.mutate({body:{folderIds:U.get.selectedFolders,mediaIds:U.get.selectedMedia,recursiveMedia:t()}})},onCancel:()=>{e.state.setOpen(!1),o.reset()}},get children(){var u=Ye();return L(u,n(Re,{id:"recursiveMedia",get value(){return t()},onChange:i=>{s(i)},name:"recursiveMedia",get copy(){return{label:r()("recursive_media_deletion"),describedBy:r()("recursive_media_deletion_description")}},theme:"fit",noMargin:!0})),u}})};var ue=N("<span>"),et=N('<span class="font-medium text-body text-sm">'),tt=N('<ul class="flex flex-wrap items-center gap-1"><li></li><li aria-hidden=true class=px-1></li><li>'),rt=N("<li aria-hidden=true class=px-1>"),at=N('<span class="font-medium text-title text-sm">'),nt=N("<li>");const st=e=>(()=>{var t=tt(),s=t.firstChild,o=s.nextSibling,u=o.nextSibling;return L(s,n(Y,{href:"/admin",class:"hover:text-title text-sm",get children(){return n(pe,{})}})),L(o,n(ae,{size:10,class:"fill-current mt-px"})),L(u,n(ne,{get children(){return[n(V,{get when(){return e.state.parentFolderId()!==""},get children(){return n(Y,{href:"/admin/media",class:"hover:text-title text-sm",noScroll:!0,get children(){var i=ue();return L(i,()=>r()("media_library")),i}})}}),n(V,{get when(){return e.state.parentFolderId()===""},get children(){var i=et();return L(i,()=>r()("media_library")),i}})]}})),L(t,n(K,{get each(){return e.state.breadcrumbs},children:(i,_)=>[(()=>{var I=rt();return L(I,n(ae,{size:10,class:"fill-current mt-px"})),I})(),(()=>{var I=nt();return L(I,n(ne,{get children(){return[n(V,{get when(){return _()!==e.state.breadcrumbs.length-1},get children(){return n(Y,{get href(){return`/admin/media/${i.id}`},class:"hover:text-title text-sm",noScroll:!0,get children(){var h=ue();return L(h,()=>i.title),h}})}}),n(V,{get when(){return _()===e.state.breadcrumbs.length-1},get children(){var h=at();return L(h,()=>i.title),h}})]}})),I})()]}),null),he(()=>fe(t,"aria-label",r()("breadcrumbs"))),t})();var ot=N('<div class="fixed bottom-4 md:bottom-6 left-[220px] right-0 flex justify-center items-center z-40 pointer-events-none px-4"><div class="pointer-events-auto bg-card-base p-2 border border-border rounded-md max-w-[400px] w-full justify-between flex items-center"><p class=text-sm><span class=font-bold></span> </p><div class="ml-2 flex gap-2">');const it=e=>{const t=y(()=>e.state.selectedFolders.length>0||e.state.selectedMedia.length>0);return n(R,{get when(){return t()},get children(){var s=ot(),o=s.firstChild,u=o.firstChild,i=u.firstChild;i.nextSibling;var _=u.nextSibling;return L(i,(()=>{var I=y(()=>!!t());return()=>I()?`${e.state.selectedFolders.length} ${r()("folders")}, ${e.state.selectedMedia.length} ${r()("media")}`:r()("nothing_selected")})()),L(u,()=>r()("selected"),null),L(_,n(de,{theme:"border-outline",size:"small",onClick:()=>{e.actions.resetSelectedFolders(),e.actions.resetSelectedMedia()},get children(){return r()("reset")}}),null),L(_,n(de,{theme:"danger",size:"small",onClick:()=>{e.actions.deleteAction()},get children(){return r()("delete")}}),null),s}})},dt=e=>{const t=x.media.useRestore({onSuccess:()=>{e.state.setOpen(!1)}});return n(z,{theme:"primary",get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var s;return{title:r()("restore_media_modal_title"),description:r()("restore_media_modal_description"),error:(s=t.errors())==null?void 0:s.message}},callbacks:{onConfirm:()=>{const s=e.id();if(!s)return console.error("No id provided");t.action.mutate({body:{ids:[s]}})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})},lt=e=>{const t=x.media.useDeleteSinglePermanently({onSuccess:()=>{e.state.setOpen(!1)}});return n(z,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:t.action.isPending,isError:t.action.isError}},get copy(){var s;return{title:r()("delete_media_permanently_modal_title"),description:r()("delete_media_permanently_modal_description"),error:(s=t.errors())==null?void 0:s.message}},callbacks:{onConfirm:()=>{const s=e.id();if(!s)return console.error("No id provided");t.action.mutate({id:s})},onCancel:()=>{e.state.setOpen(!1),t.reset()}}})},ct=e=>{const t=x.media.useMoveFolder({onSuccess:()=>{e.state.setOpen(!1)}}),s=x.mediaFolders.useUpdateSingle({onSuccess:()=>{e.state.setOpen(!1)}}),o=y(()=>e.state.params.mode==="media"),u=y(()=>t.action.isPending||s.action.isPending),i=y(()=>t.action.isError||s.action.isError),_=y(()=>{var h,p;return((h=t.errors())==null?void 0:h.message)||((p=s.errors())==null?void 0:p.message)});return n(z,{theme:"primary",get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:u(),isError:i()}},get copy(){return{title:o()?r()("move_media_modal_title"):r()("move_folder_modal_title"),description:o()?r()("move_media_modal_description"):r()("move_folder_modal_description"),error:_()}},callbacks:{onConfirm:()=>{if(e.state.params.mode==="media"){if(!e.state.params.itemId)return console.error("No media id provided");t.action.mutate({id:e.state.params.itemId,body:{folderId:e.state.params.target??null}});return}if(!e.state.params.itemId)return console.error("No folder id provided");s.action.mutate({id:e.state.params.itemId,body:{parentFolderId:e.state.params.target??null}})},onCancel:()=>{e.state.setOpen(!1),t.reset(),s.reset()}}})},ut=e=>{const[t,s]=S(""),[o,u]=S(void 0),i=x.mediaFolders.useGetHierarchy({queryParams:{}}),_=x.mediaFolders.useUpdateSingle({onSuccess:()=>{e.state.setOpen(!1)}}),I=y(()=>{var l;const h=((l=i.data)==null?void 0:l.data)||[],p=e.id(),m=h.slice().sort((g,b)=>{var v,F;return(((v=g.meta)==null?void 0:v.order)??0)-(((F=b.meta)==null?void 0:F.order)??0)}).filter(g=>g.id!==p).map(g=>{var v,F,C;let b=((v=g.meta)==null?void 0:v.label)??g.title;return(F=g.meta)!=null&&F.level&&((C=g.meta)==null?void 0:C.level)>0&&(b=`| ${b}`),{value:g.id,label:b}});return[{value:void 0,label:r()("no_folder")},...m]});return j(()=>{var h;if(e.state.open){const p=e.id(),l=(((h=i.data)==null?void 0:h.data)||[]).find(g=>g.id===p);l&&(s(l.title),u(l.parentFolderId??null))}}),n(X,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get mutateState(){return{isLoading:_.action.isPending,errors:_.errors()}},get fetchState(){return{isLoading:i.isLoading,isError:i.isError}},callbacks:{onSubmit:()=>{const h=e.id();h&&_.action.mutate({id:h,body:{title:t(),parentFolderId:o()??null}})},reset:()=>{_.reset(),s(""),u(void 0)}},get copy(){return{title:r()("update_media_folder_panel_title"),description:r()("update_media_folder_panel_description"),submit:r()("update")}},options:{padding:"24"},children:()=>[n(G,{id:"title",get value(){return t()},onChange:s,name:"title",type:"text",required:!0,get copy(){return{label:r()("title")}},get errors(){return H("title",_.errors)},theme:"full"}),n(J,{id:"parent-folder",get value(){return o()??void 0},onChange:h=>{const p=typeof h=="string"?Number.parseInt(h,10):h;u(p??null)},name:"parent-folder",get options(){return I()},get copy(){return{label:r()("folder")}},noClear:!0,get errors(){return H("parentFolderId",_.errors)},theme:"full"})]})},gt=e=>{const t=Ce({triggers:{update:!1,delete:!1,clear:!1,restore:!1,deletePermanently:!1,deleteBatch:!1,moveToFolder:!1,view:!1,updateFolder:!1}}),[s,o]=S(!1),[u,i]=S({mode:"media",itemId:null,target:null}),_=y(()=>re.get.contentLocale),I=y(()=>e.state.showingDeleted()?1:0),h=x.media.useGetMultiple({queryParams:{queryString:e.state.searchParams.getQueryString,filters:{folderId:e.state.parentFolderId,isDeleted:I},headers:{"lucid-content-locale":_}},enabled:()=>e.state.searchParams.getSettled()}),p=x.mediaFolders.useGetMultiple({queryParams:{filters:{parentFolderId:e.state.parentFolderId},perPage:-1}}),m=a=>{var c,d,w;if((c=a.draggable)!=null&&c.id&&((d=a.droppable)!=null&&d.id)&&((w=a.draggable)==null?void 0:w.id)!==a.droppable.id&&typeof a.draggable.id=="string"&&typeof a.droppable.id=="string"){const P=Number(a.draggable.id.split(":")[1]),T=Number(a.droppable.id.split(":")[1]),O=a.draggable.id.split(":")[0];i({mode:O,itemId:P,target:T}),t.setTrigger("moveToFolder",!0)}setTimeout(()=>o(!1),100)},l=()=>{o(!0)},g=()=>{e.state.setOpenCreateMediaPanel(!0)},b=y(()=>{var a;return((a=p.data)==null?void 0:a.data.folders.length)||0}),v=y(()=>{var a;return((a=h.data)==null?void 0:a.data.length)||0}),F=y(()=>e.state.parentFolderId()===""),C=y(()=>h.isError||p.isError),E=y(()=>h.isSuccess&&p.isSuccess),D=y(()=>(e.state.showingDeleted()||F()&&b()===0)&&v()===0),A=y(()=>e.state.showingDeleted()?{title:r()("no_deleted_media"),description:r()("no_deleted_media_description")}:{title:r()("no_media"),description:r()("no_media_description"),button:r()("upload_media")}),M=y(()=>{if(!e.state.showingDeleted())return g}),$=y(()=>!e.state.showingDeleted()&&(!F()||b()>0)),f=y(()=>F()?{title:r()("no_media"),description:r()("no_media_description"),button:r()("upload_media")}:{title:r()("no_media_in_folder"),description:r()("no_media_in_folder_description"),button:r()("upload_media")});return n(Pe,{get state(){return{isError:C(),isSuccess:E(),isEmpty:D(),searchParams:e.state.searchParams}},get slot(){return{footer:n(Se,{get state(){var a;return{searchParams:e.state.searchParams,meta:(a=h.data)==null?void 0:a.meta}},options:{padding:"24"}})}},get copy(){return{noEntries:A()}},get callback(){return{createEntry:M()}},options:{padding:"24"},get children(){return[n(Te,{onDragEnd:m,onDragStart:l,get children(){return[n(Ee,{}),n(R,{get when(){return $()},get children(){return[n(st,{get state(){var a;return{parentFolderId:e.state.parentFolderId,breadcrumbs:((a=p.data)==null?void 0:a.data.breadcrumbs)??[]}}}),n(oe,{get state(){return{isLoading:p.isLoading,totalItems:b()}},options:{disableEmpty:!0},get slots(){return{loadingCard:n(Oe,{})}},get class(){return ye("border-b border-border pb-4 md:pb-6 mb-4 md:mb-6",{"mt-4":b()>0})},get children(){return n(K,{get each(){var a;return(a=p.data)==null?void 0:a.data.folders},children:a=>n(Le,{folder:a,isDragging:s,rowTarget:t})})}})]}}),n(oe,{get state(){return{isLoading:h.isFetching,totalItems:v(),searchParams:e.state.searchParams}},get slots(){return{loadingCard:n(De,{})}},get copy(){return{empty:f()}},get callback(){return{createEntry:M()}},options:{growWhenEmpty:!0},get children(){return n(K,{get each(){var a;return(a=h.data)==null?void 0:a.data},children:a=>n(ke,{media:a,rowTarget:t,get contentLocale(){return _()},get showingDeleted(){return e.state.showingDeleted},isDragging:s})})}})]}}),n(it,{get state(){return{selectedFolders:U.get.selectedFolders,selectedMedia:U.get.selectedMedia}},get actions(){return{addSelectedFolder:U.get.addSelectedFolder,addSelectedMedia:U.get.addSelectedMedia,resetSelectedFolders:U.get.resetSelectedFolders,resetSelectedMedia:U.get.resetSelectedMedia,deleteAction:()=>{t.setTrigger("deleteBatch",!0)}}}}),n(ct,{get state(){return{open:t.getTriggers().moveToFolder,setOpen:a=>{t.setTrigger("moveToFolder",a)},params:u()}}}),n(me,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().update,setOpen:a=>{t.setTrigger("update",a)},parentFolderId:e.state.parentFolderId}}}),n(We,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().view,setOpen:a=>{t.setTrigger("view",a)},parentFolderId:e.state.parentFolderId}}}),n(ut,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().updateFolder,setOpen:a=>{t.setTrigger("updateFolder",a)},parentFolderId:e.state.parentFolderId}}}),n(Je,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().delete,setOpen:a=>{t.setTrigger("delete",a)}}}}),n(lt,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().deletePermanently,setOpen:a=>{t.setTrigger("deletePermanently",a)}}}}),n(dt,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().restore,setOpen:a=>{t.setTrigger("restore",a)}}}}),n(Xe,{get id(){return t.getTargetId},get state(){return{open:t.getTriggers().clear,setOpen:a=>{t.setTrigger("clear",a)}}}}),n(Ze,{get state(){return{open:t.getTriggers().deleteBatch,setOpen:a=>{t.setTrigger("deleteBatch",a)}}}})]}})},mt=e=>{const[t,s]=S(""),[o,u]=S(void 0),i=x.mediaFolders.useCreateSingle({onSuccess:()=>{e.state.setOpen(!1)}}),_=x.mediaFolders.useGetHierarchy({queryParams:{}}),I=y(()=>{const p=e.state.parentFolderId();return p===""?null:typeof p=="string"?Number.parseInt(p,10):p}),h=y(()=>{var l;const m=(((l=_.data)==null?void 0:l.data)||[]).slice().sort((g,b)=>{var v,F;return(((v=g.meta)==null?void 0:v.order)??0)-(((F=b.meta)==null?void 0:F.order)??0)}).map(g=>{var v,F,C;let b=((v=g.meta)==null?void 0:v.label)??g.title;return(F=g.meta)!=null&&F.level&&((C=g.meta)==null?void 0:C.level)>0&&(b=`| ${b}`),{value:g.id,label:b}});return[{value:void 0,label:r()("no_folder")},...m]});return j(()=>{e.state.open&&u(I())}),n(X,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get mutateState(){return{isLoading:i.action.isPending,errors:i.errors()}},get fetchState(){return{isLoading:_.isLoading,isError:_.isError}},callbacks:{onSubmit:()=>{i.action.mutate({title:t(),parentFolderId:o()??null})},reset:()=>{i.reset(),s(""),u(void 0)}},get copy(){return{title:r()("create_media_folder_panel_title"),description:r()("create_media_folder_panel_description"),submit:r()("create")}},options:{padding:"24"},children:()=>[n(G,{id:"title",get value(){return t()},onChange:s,name:"title",type:"text",required:!0,get copy(){return{label:r()("title")}},get errors(){return H("title",i.errors)},theme:"full"}),n(J,{id:"parent-folder",get value(){return o()??void 0},onChange:p=>{const m=typeof p=="string"?Number.parseInt(p,10):p;u(m??null)},name:"parent-folder",get options(){return h()},get copy(){return{label:r()("folder")}},noClear:!0,theme:"full"})]})},$t=()=>{const e=_e(),t=we({filters:{title:{value:"",type:"text"},extension:{value:"",type:"text"},type:{value:"",type:"array"},mimeType:{value:"",type:"text"},key:{value:"",type:"text"}},sorts:{fileSize:void 0,title:void 0,width:void 0,height:void 0,mimeType:void 0,extension:void 0,createdAt:void 0,updatedAt:"desc"},pagination:{perPage:20}},{singleSort:!0}),s=be(),[o,u]=S(!1),[i,_]=S(!1),[I,h]=S(!1),p=y(()=>{if(I())return;const l=s.folderId;if(!l)return"";const g=Number.parseInt(l,10);return Number.isNaN(g)?"":g}),m=x.settings.useGetSettings({queryParams:{}});return j(()=>{I()&&U.get.reset()}),n(Fe,{get slots(){return{topBar:n(ve,{style:"layout",get alerts(){var l;return[{type:"warning",message:r()("media_support_config_stategy_error"),show:((l=m.data)==null?void 0:l.data.media.enabled)===!1}]}}),header:n(Ie,{get copy(){return{title:r()("media_route_title"),description:r()("media_route_description")}},get actions(){return{create:[{open:i(),setOpen:_,permission:se.get.hasPermission(["create_media"]).all,label:r()("add_folder"),secondary:!0},{open:o(),setOpen:u,permission:se.get.hasPermission(["create_media"]).all,label:r()("upload_media")}],contentLocale:!0}},get slots(){return{bottom:n(Ae,{searchParams:t,showingDeleted:I,setShowingDeleted:h,onRefresh:()=>{e.invalidateQueries({queryKey:["media.getMultiple"]}),e.invalidateQueries({queryKey:["mediaFolders.getMultiple"]})},get filters(){return[{label:r()("title"),key:"title",type:"text"},{label:r()("mime_type"),key:"mimeType",type:"text"},{label:r()("key"),key:"key",type:"text"},{label:r()("type"),key:"type",type:"multi-select",options:[{label:r()("image"),value:"image"},{label:r()("video"),value:"video"},{label:r()("audio"),value:"audio"},{label:r()("document"),value:"document"},{label:r()("archive"),value:"archive"},{label:r()("unknown"),value:"unknown"}]},{label:r()("file_extension"),key:"extension",type:"text"}]},get sorts(){return[{label:r()("title"),key:"title"},{label:r()("file_size"),key:"fileSize"},{label:r()("mime_type"),key:"mimeType"},{label:r()("file_extension"),key:"extension"},{label:r()("width"),key:"width"},{label:r()("height"),key:"height"},{label:r()("created_at"),key:"createdAt"},{label:r()("updated_at"),key:"updatedAt"}]},perPage:[10,20,40]})}}})}},get children(){return[n(gt,{state:{searchParams:t,showingDeleted:I,setOpenCreateMediaPanel:u,parentFolderId:p}}),n(me,{get state(){return{open:o(),setOpen:u,parentFolderId:p}}}),n(mt,{get state(){return{open:i(),setOpen:_,parentFolderId:p}}})]}})};export{$t as default};
