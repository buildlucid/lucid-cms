import{G as H,u as C,y as n,z as U,e as k,f as R,B as P,T as I,a5 as E,Y as $,a,M as Q,t as x,i as m,d as Y,v as J,h as X}from"./index-CQ3-BSEL.js";import{u as Z}from"./useSearchParamsState-BdNLU5Q4.js";import{w as v,L as ee}from"./Tooltip-C4WAYcWb.js";import{u as te,H as oe,A as ne,C as se,F as ie,c as ce,R as re}from"./useDocumentUIState-BmTsPFAa.js";import"./Tr-Dh-rHsqH.js";import"./useSearchParamsLocation-Sjso8rcp.js";import"./ContentLocaleSelect-Cb-MBOKh.js";import"./DateText-zHyly9WS.js";import"./date-helpers-BWhv-7yI.js";import"./ISASYZ5H-BKhR2em3.js";import"./Pill-BBVDx-5p.js";import"./error-helpers-D9jUdhyT.js";import"./ActionDropdown-DU8N8G-B.js";function le(){const l=H(),e=C(),u=Z({sorts:{createdAt:"desc"},pagination:{perPage:6}},{singleSort:!0}),c=n(()=>l.collectionKey),s=n(()=>Number.parseInt(l.documentId)||void 0),r=n(()=>l.versionId),g=n(()=>{if(r()!=="latest")return Number.parseInt(r())}),h=n(()=>U.get.contentLocale),S=n(()=>h()!==void 0&&s()!==void 0&&u.getSettled()),o=n(()=>h()!==void 0&&s()!==void 0&&g()!==void 0),i=k.collections.useGetSingle({queryParams:{location:{collectionKey:c}},enabled:()=>!!c(),refetchOnWindowFocus:!1}),y=k.documents.useGetSingleVersion({queryParams:{location:{collectionKey:c,id:s,versionId:g},include:{bricks:!0}},enabled:()=>o(),refetchOnWindowFocus:!1}),d=k.documents.useGetMultipleRevisions({queryParams:{queryString:u.getQueryString,location:{collectionKey:c,documentId:s}},enabled:()=>S(),refetchOnWindowFocus:!1}),f=n(()=>{var t;return(t=i.data)==null?void 0:t.data}),F=n(()=>{var t;return g()!==void 0||i.isFetched===!1?!1:h()!==void 0&&s()!==void 0&&((t=f())==null?void 0:t.config.useDrafts)!==void 0}),M=n(()=>{var t;return(t=f())!=null&&t.config.useDrafts?"draft":"published"}),_=k.documents.useGetSingle({queryParams:{location:{collectionKey:c,id:s,version:M},include:{bricks:!0}},enabled:()=>F(),refetchOnWindowFocus:!1}),b=n(()=>o()?y:_),w=n(()=>{var t;return(t=b().data)==null?void 0:t.data}),A=n(()=>{var t;return(t=y.data)==null?void 0:t.data}),B=n(()=>{var t;return(t=_.data)==null?void 0:t.data}),V=n(()=>r()==="latest"?i.isLoading||d.isLoading:i.isLoading||b().isLoading),T=n(()=>r()==="latest"?i.isSuccess&&d.isSuccess:i.isSuccess&&b().isSuccess),q=n(()=>d.isLoading),z=n(()=>d.isSuccess),G=n(()=>d.isError||i.isError||b().isError),O=n(()=>{var t,p,N,K,D,L;return((N=(p=(t=w())==null?void 0:t.version)==null?void 0:p.published)==null?void 0:N.id)!==null&&((L=(D=(K=w())==null?void 0:K.version)==null?void 0:D.published)==null?void 0:L.id)!==void 0});R(()=>{var t;if(r()==="latest"){const p=(t=d.data)==null?void 0:t.data[0];p&&e(`/admin/collections/${c()}/revisions/${s()}/${p.id}`)}});const W=n(()=>{var t;return P.getLocaleValue({value:(t=f())==null?void 0:t.details.name})}),j=n(()=>{var t;return P.getLocaleValue({value:(t=f())==null?void 0:t.details.singularName})||I()("collection")});return{collectionQuery:i,documentQuery:b,document:w,revisionDocument:A,fallbackDocument:B,collection:f,revisionDocumentQuery:y,fallbackDocumentQuery:_,revisionVersionsQuery:d,collectionKey:c,documentId:s,versionId:g,versionIdParam:r,revisionsSearchParams:u,documentIsLoading:V,documentIsSuccess:T,revisionsIsLoading:q,revisionsIsSuccess:z,anyIsError:G,isPublished:O,collectionName:W,collectionSingularName:j}}function ae(l){const e=C(),u=k.documents.useRestoreRevision({onSuccess:()=>{var s;v.set("fieldsErrors",[]),v.set("documentMutated",!1),e(E("edit",{collectionKey:l.collectionKey(),useDrafts:(s=l.collection())==null?void 0:s.config.useDrafts,documentId:l.documentId()}))},onError:()=>{v.set("fieldsErrors",[]),v.set("documentMutated",!1)},getCollectionName:l.collectionSingularName});return{restoreRevision:u,restoreRevisionAction:()=>{const s=l.versionId();if(s===void 0){console.error("No version ID found.");return}u.action.mutate({collectionKey:l.collectionKey(),id:l.documentId(),versionId:s})}}}var ue=x('<span class="absolute top-0 left-[220px] right-4 h-32 bg-background-hover z-5">'),de=x('<div class="fixed top-4 left-[220px] bottom-4 right-4 flex flex-col z-10"><span class="h-32 w-full skeleton block mb-4"></span><span class="h-full w-full skeleton block">'),me=x('<div class="absolute inset-0 flex items-center justify-center bg-black/60 flex-col z-20"><div class="w-full max-w-xl px-4 py-4 text-center flex flex-col items-center"><h2 class=mb-2.5></h2><p class=mb-5>'),ge=x('<div class="mt-2 bg-background-base rounded-t-xl border border-border flex-grow overflow-hidden relative"><div class="flex flex-col h-full"><div class="w-full flex grow h-full"><div class="w-full flex flex-col">');const Ne=l=>{const e=le(),u=ae({collectionKey:e.collectionKey,documentId:e.documentId,collectionSingularName:e.collectionSingularName,versionId:e.versionId,collection:e.collection}),c=te({collectionQuery:e.collectionQuery,documentQuery:e.documentQuery(),document:e.document,collection:e.collection,mode:"revisions",version:"draft",selectedRevision:e.documentId,restoreRevisionAction:u.restoreRevisionAction}),s=()=>{var r;v.get.reset(),v.set("collectionTranslations",((r=e.collection())==null?void 0:r.config.useTranslations)||!1),v.get.setBricks(e.document(),e.collection()),v.set("locked",!0)};return R($(()=>e.document(),()=>{s()})),R($(()=>e.collectionQuery.isSuccess,()=>{s()})),a(X,{get children(){return[a(Q,{get when(){return e.documentIsLoading()},get children(){return[ue(),de()]}}),a(Q,{get when(){return e.documentIsSuccess()},get children(){return[a(oe,{mode:"revisions",get state(){return{collection:e.collection,collectionKey:e.collectionKey,collectionName:e.collectionName,collectionSingularName:e.collectionSingularName,documentID:e.documentId,canNavigateToPublished:c.canNavigateToPublished,showRevisionNavigation:c.showRevisionNavigation}}}),a(ne,{mode:"revisions",get state(){return{collection:e.collection,document:e.document,selectedRevision:e.documentId,ui:c}},get actions(){return{restoreRevisionAction:u.restoreRevisionAction}}}),(()=>{var r=ge(),g=r.firstChild,h=g.firstChild,S=h.firstChild;return m(r,a(Y,{get when(){return!e.revisionDocument()},get children(){var o=me(),i=o.firstChild,y=i.firstChild,d=y.nextSibling;return m(y,()=>I()("no_revisions_found")),m(d,()=>I()("no_revisions_found_message")),m(i,a(ee,{get href(){var f;return E("edit",{collectionKey:e.collectionKey(),useDrafts:(f=e.collection())==null?void 0:f.config.useDrafts,documentId:e.documentId()})},theme:"primary",size:"medium",get children(){return I()("back_to_document")}}),null),o}}),g),m(g,a(J,{style:"layout",get alerts(){return[{type:"info",message:I()("locked_document_message"),show:!0},{type:"info",message:I()("collection_needs_migrating_message"),show:c.collectionNeedsMigrating()}]}}),h),m(S,a(se,{get fields(){var o;return((o=e.collection())==null?void 0:o.fields)||[]},get collectionMigrationStatus(){var o;return(o=e.collection())==null?void 0:o.migrationStatus},get collectionKey(){return e.collectionKey()},get documentId(){return e.documentId()}}),null),m(S,a(ie,{get brickConfig(){var o;return((o=e.collection())==null?void 0:o.fixedBricks)||[]},get collectionMigrationStatus(){var o;return(o=e.collection())==null?void 0:o.migrationStatus},get collectionKey(){return e.collectionKey()},get documentId(){return e.documentId()}}),null),m(S,a(ce,{get brickConfig(){var o;return((o=e.collection())==null?void 0:o.builderBricks)||[]},get collectionMigrationStatus(){var o;return(o=e.collection())==null?void 0:o.migrationStatus},get collectionKey(){return e.collectionKey()},get documentId(){return e.documentId()}}),null),m(h,a(re,{get state(){var o,i;return{revisions:((o=e.revisionVersionsQuery.data)==null?void 0:o.data)||[],meta:(i=e.revisionVersionsQuery.data)==null?void 0:i.meta,versionId:e.versionId,collectionKey:e.collectionKey,documentId:e.documentId,searchParams:e.revisionsSearchParams,isLoading:e.revisionsIsLoading,isError:e.anyIsError,isSuccess:e.revisionsIsSuccess,hideNoEntries:e.versionIdParam()==="latest"}}}),null),r})()]}})]}})};export{Ne as default};
