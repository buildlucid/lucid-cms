import{a as t,x as C,T as r,b as T,e as h,f as B,y as g,B as K,t as v,i as S,r as E,I as U,K as W,L as O,E as j,W as H}from"./index-CQ3-BSEL.js";import{u as z}from"./useSearchParamsLocation-Sjso8rcp.js";import{T as J,Q as V}from"./Tr-Dh-rHsqH.js";import{g as X}from"./error-helpers-D9jUdhyT.js";import{P as Y}from"./Panel-BJ5ATSyq.js";import{S as R}from"./SectionHeading-CnvfN_LE.js";import{C as I}from"./ActionDropdown-DU8N8G-B.js";import{I as Z}from"./Tooltip-C4WAYcWb.js";import{I as ee}from"./InputGrid-CUmOd9Qi.js";import{S as te}from"./Standard-DQ0Jv3GR.js";import"./MediaFolderCard-DV834B6M.js";import{u as re}from"./useRowTarget-DdIL0a9L.js";import{P as ae}from"./Paginated-uZRH6cV0.js";import{D as ne}from"./ContentLocaleSelect-Cb-MBOKh.js";import{T as se,D as L,a as ie}from"./DateCol-D5X8S346.js";import{C as le}from"./Confirmation-BG2UDkdk.js";import"./ISASYZ5H-BKhR2em3.js";import"./ErrorMessage-BUQl5hDc.js";import"./DateText-zHyly9WS.js";import"./date-helpers-BWhv-7yI.js";const oe=e=>t(J,{get index(){return e.index},get selected(){return e.selected},get actions(){return[{label:r()("edit"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.role.id),e.rowTarget.setTrigger("update",!0)},permission:C.get.hasPermission(["update_role"]).all},{label:r()("delete"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.role.id),e.rowTarget.setTrigger("delete",!0)},permission:C.get.hasPermission(["delete_role"]).all,actionExclude:!0}]},get options(){return e.options},get callbacks(){return e.callbacks},get children(){return[t(se,{get text(){return e.role.name},get options(){return{include:e==null?void 0:e.include[0]}}}),t(L,{get date(){return e.role.createdAt},get options(){return{include:e==null?void 0:e.include[1]}}}),t(L,{get date(){return e.role.updatedAt},get options(){return{include:e==null?void 0:e.include[2]}}})]}});var de=v("<div>"),ue=v('<div class="w-full mb-5 last:mb-0"><div class=w-full>'),ce=v('<div class="mb-4 last:mb-0"><h4></h4><div class="mt-2 border border-border p-4 rounded-md grid grid-cols-2 gap-x-4 gap-y-2 bg-card-base">');const w=e=>{const[s,a]=T([]),[n,b]=T(""),o=h.roles.useGetSingle({queryParams:{location:{roleId:e.id}},key:()=>e.state.open,enabled:()=>e.state.open&&e.id!==void 0}),d=h.permissions.useGetAll({queryParams:{},enabled:()=>e.state.open}),m=h.roles.useCreateSingle({onSuccess:()=>{e.state.setOpen(!1)}}),f=h.roles.useUpdateSingle({onSuccess:()=>{e.state.setOpen(!1)}});B(()=>{var i,u,l;o.isSuccess&&(a(((u=(i=o.data)==null?void 0:i.data.permissions)==null?void 0:u.map(c=>c.permission))||[]),b(((l=o.data)==null?void 0:l.data.name)||""))});const D=g(()=>e.id===void 0?d.isLoading:o.isLoading||d.isLoading),$=g(()=>e.id===void 0?d.isError:o.isError||d.isError),q=g(()=>{var i;return e.id===void 0?r()("create_role_panel_title"):r()("update_role_panel_title",{name:((i=o.data)==null?void 0:i.data.name)||""})}),A=g(()=>{var i;return e.id===void 0?r()("create_role_panel_description"):r()("update_role_panel_description",{name:((i=o.data)==null?void 0:i.data.name)||""})}),M=g(()=>e.id===void 0?r()("create"):r()("update")),k=g(()=>{var i,u,l;return K.updateData({name:(i=o.data)==null?void 0:i.data.name,permissions:((l=(u=o.data)==null?void 0:u.data.permissions)==null?void 0:l.map(c=>c.permission))||[]},{name:n(),permissions:s()||[]})}),Q=g(()=>e.id?!k().changed:!1),F=g(()=>{var u;const i=(u=d.data)==null?void 0:u.data.reduce((l,c)=>l+c.permissions.length,0);return s().length===i}),G=g(()=>m.action.isPending||f.action.isPending),x=g(()=>e.id?f.errors():m.errors());return t(Y,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get fetchState(){return{isLoading:D(),isError:$()}},get mutateState(){return{isLoading:G(),isDisabled:Q(),errors:x()}},callbacks:{onSubmit:()=>{e.id?f.action.mutate({id:e.id(),body:k().data}):m.action.mutate({name:n(),permissions:s()})},reset:()=>{a([]),b(""),m.reset(),f.reset()}},get copy(){return{title:q(),description:A(),submit:M()}},options:{padding:"24"},children:()=>[t(R,{get title(){return r()("details")}}),t(ee,{columns:2,get children(){return t(Z,{id:"name",name:"name",type:"text",get value(){return n()},onChange:b,get copy(){return{label:r()("name")}},required:!0,get errors(){return X("name",x)},noMargin:!0,theme:"full"})}}),(()=>{var i=ue(),u=i.firstChild;return S(i,t(R,{get title(){return r()("permissions")},headingType:"h3",get children(){var l=de();return S(l,t(I,{get value(){return F()},onChange:c=>{var _;a(c?((_=d.data)==null?void 0:_.data.flatMap(p=>p.permissions))||[]:[])},copy:{},noMargin:!0,theme:"full"})),l}}),u),S(u,t(E,{get each(){var l;return(l=d==null?void 0:d.data)==null?void 0:l.data},children:l=>(()=>{var c=ce(),_=c.firstChild,p=_.nextSibling;return S(_,()=>r(l.key)),S(p,t(E,{get each(){return l.permissions},children:y=>t(I,{get value(){return s().includes(y)},onChange:()=>a(P=>P.includes(y)?P.filter(N=>N!==y):[...P,y]),get copy(){return{label:r()(`permissions_${y}`)}},noMargin:!0,theme:"full"})})),c})()})),i})()]})},ge=e=>{const s=h.roles.useDeleteSingle({onSuccess:()=>{e.state.setOpen(!1)}});return t(le,{get state(){return{open:e.state.open,setOpen:e.state.setOpen,isLoading:s.action.isPending,isError:s.action.isError}},get copy(){var a;return{title:r()("delete_role_modal_title"),description:r()("delete_role_modal_description"),error:(a=s.errors())==null?void 0:a.message}},callbacks:{onConfirm:()=>{const a=e.id();if(!a)return console.error("No id provided");s.action.mutate({id:a})},onCancel:()=>{e.state.setOpen(!1),s.reset()}}})},me=e=>{const s=re({triggers:{update:!1,delete:!1}}),a=h.roles.useGetMultiple({queryParams:{queryString:e.state.searchParams.getQueryString,include:{permissions:!1}},enabled:()=>e.state.searchParams.getSettled()});return t(ne,{get state(){var n;return{isError:a.isError,isSuccess:a.isSuccess,isEmpty:((n=a.data)==null?void 0:n.data.length)===0,searchParams:e.state.searchParams}},get slot(){return{footer:t(ae,{get state(){var n;return{searchParams:e.state.searchParams,meta:(n=a.data)==null?void 0:n.meta}},options:{padding:"24"}})}},get copy(){return{noEntries:{title:r()("no_roles"),description:r()("no_roles_description"),button:r()("create_role")}}},callback:{createEntry:()=>{e.state.setOpenCreateRolePanel(!0)}},get children(){return[t(ie,{key:"roles.list",get rows(){var n;return((n=a.data)==null?void 0:n.data.length)||0},get searchParams(){return e.state.searchParams},get head(){return[{label:r()("name"),key:"name",icon:t(W,{}),sortable:!0},{label:r()("created_at"),key:"createdAt",icon:t(O,{}),sortable:!0},{label:r()("updated_at"),key:"updatedAt",icon:t(O,{})}]},get state(){return{isLoading:a.isFetching,isSuccess:a.isSuccess}},options:{isSelectable:!1},children:({include:n,isSelectable:b,selected:o,setSelected:d})=>t(U,{get each(){var m;return((m=a.data)==null?void 0:m.data)||[]},children:(m,f)=>t(oe,{index:f,get role(){return m()},include:n,get selected(){return o[f]},rowTarget:s,options:{isSelectable:b},callbacks:{setSelected:d}})})}),t(w,{get id(){return s.getTargetId},get state(){return{open:s.getTriggers().update,setOpen:n=>{s.setTrigger("update",n)}}}}),t(ge,{get id(){return s.getTargetId},get state(){return{open:s.getTriggers().delete,setOpen:n=>{s.setTrigger("delete",n)}}}})]}})},$e=()=>{const e=j(),s=z({filters:{name:{value:"",type:"text"}},sorts:{name:void 0,createdAt:void 0}},{singleSort:!0}),[a,n]=T(!1);return t(H,{get slots(){return{header:t(te,{get copy(){return{title:r()("roles_route_title"),description:r()("roles_route_description")}},get actions(){return{create:[{open:a(),setOpen:n,permission:C.get.hasPermission(["create_role"]).all,label:r()("create_role")}]}},get slots(){return{bottom:t(V,{searchParams:s,onRefresh:()=>{e.invalidateQueries({queryKey:["roles.getMultiple"]})},get filters(){return[{label:r()("name"),key:"name",type:"text"}]},get sorts(){return[{label:r()("name"),key:"name"},{label:r()("created_at"),key:"createdAt"}]},perPage:[]})}}})}},get children(){return[t(me,{state:{searchParams:s,setOpenCreateRolePanel:n}}),t(w,{get state(){return{open:a(),setOpen:n}}})]}})};export{$e as default};
