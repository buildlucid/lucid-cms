import{a,x as D,T as t,e as w,d as S,t as q,i as P,I as C,K as g,U as b,L as y,E as F,W as L}from"./index-CQ3-BSEL.js";import{u as I}from"./useSearchParamsLocation-Sjso8rcp.js";import{T as E,Q as K}from"./Tr-Dh-rHsqH.js";import{S as O}from"./Standard-DQ0Jv3GR.js";import"./MediaFolderCard-DV834B6M.js";import"./Tooltip-C4WAYcWb.js";import{u as Q}from"./useRowTarget-DdIL0a9L.js";import{P as R}from"./Paginated-uZRH6cV0.js";import{D as J}from"./ContentLocaleSelect-Cb-MBOKh.js";import{T,D as v,a as $}from"./DateCol-D5X8S346.js";import{P as m}from"./PillCol-CVehCi4c.js";import{P as p}from"./Panel-BJ5ATSyq.js";import{S as _}from"./SectionHeading-CnvfN_LE.js";import{D as M}from"./DetailsList-BHEhgC4b.js";import{J as G}from"./JSONPreview-Dl81wgPP.js";import{d as s}from"./date-helpers-BWhv-7yI.js";import"./ActionDropdown-DU8N8G-B.js";import"./Confirmation-BG2UDkdk.js";import"./ISASYZ5H-BKhR2em3.js";import"./ErrorMessage-BUQl5hDc.js";import"./DateText-zHyly9WS.js";import"./Pill-BBVDx-5p.js";const H=e=>a(E,{get index(){return e.index},get selected(){return e.selected},get options(){return e.options},get callbacks(){return e.callbacks},get actions(){return[{label:t()("preview"),type:"button",onClick:()=>{e.rowTarget.setTargetId(e.job.id),e.rowTarget.setTrigger("preview",!0)},permission:D.get.hasPermission(["read_email"]).all}]},get children(){return[a(m,{get text(){return e.job.status},get theme(){return e.job.status==="completed"?"primary":e.job.status==="failed"?"red":e.job.status==="processing"?"secondary":"grey"},get options(){return{include:e==null?void 0:e.include[0]}}}),a(T,{get text(){return e.job.eventType},get options(){return{include:e==null?void 0:e.include[1],maxLines:1}}}),a(T,{get text(){return e.job.queueAdapterKey},get options(){return{include:e==null?void 0:e.include[2],maxLines:1}}}),a(m,{get text(){return e.job.attempts},theme:"grey",get options(){return{include:e==null?void 0:e.include[3]}}}),a(m,{get text(){return e.job.maxAttempts},theme:"grey",get options(){return{include:e==null?void 0:e.include[4]}}}),a(m,{get text(){return e.job.priority??"-"},theme:"grey",get options(){return{include:e==null?void 0:e.include[5]}}}),a(v,{get date(){return e.job.createdAt},get options(){return{include:e==null?void 0:e.include[6]}}}),a(v,{get date(){return e.job.scheduledFor},get options(){return{include:e==null?void 0:e.include[7]}}}),a(v,{get date(){return e.job.completedAt},get options(){return{include:e==null?void 0:e.include[8]}}})]}});var W=q('<div class="mb-4 p-4 bg-red-50 border border-red-200 rounded-md"><p class="text-sm text-red-900">'),N=q("<div class=mb-4>");const U=e=>{const r=w.jobs.useGetSingle({queryParams:{location:{jobId:e.id}},enabled:()=>!!e.id()});return a(p,{get state(){return{open:e.state.open,setOpen:e.state.setOpen}},get fetchState(){return{isLoading:r.isLoading,isError:r.isError}},options:{padding:"24",hideFooter:!0},get copy(){return{title:t()("view_job_panel_title"),description:t()("view_job_panel_description")}},children:()=>[a(_,{get title(){return t()("details")}}),a(M,{type:"text",get items(){var l,i,n,o,c,d,u,h,f,j,x,k,A;return[{label:t()("job_id"),value:((l=r.data)==null?void 0:l.data.jobId)??void 0},{label:t()("event_type"),value:((i=r.data)==null?void 0:i.data.eventType)??void 0},{label:t()("status"),value:((n=r.data)==null?void 0:n.data.status)??void 0},{label:t()("queue_adapter"),value:((o=r.data)==null?void 0:o.data.queueAdapterKey)??void 0},{label:t()("priority"),value:((c=r.data)==null?void 0:c.data.priority)??"-"},{label:t()("attempts"),value:((d=r.data)==null?void 0:d.data.attempts)??0},{label:t()("max_attempts"),value:((u=r.data)==null?void 0:u.data.maxAttempts)??0},{label:t()("created_at"),value:s.formatDate((h=r.data)==null?void 0:h.data.createdAt)},{label:t()("scheduled_for"),value:s.formatDate((f=r.data)==null?void 0:f.data.scheduledFor)},{label:t()("started_at"),value:s.formatDate((j=r.data)==null?void 0:j.data.startedAt)},{label:t()("completed_at"),value:s.formatDate((x=r.data)==null?void 0:x.data.completedAt)},{label:t()("failed_at"),value:s.formatDate((k=r.data)==null?void 0:k.data.failedAt)},{label:t()("next_retry_at"),value:s.formatDate((A=r.data)==null?void 0:A.data.nextRetryAt)}]}}),a(S,{get when(){var l;return(l=r.data)==null?void 0:l.data.errorMessage},get children(){return[a(_,{get title(){return t()("error_message")}}),(()=>{var l=W(),i=l.firstChild;return P(i,()=>{var n;return(n=r.data)==null?void 0:n.data.errorMessage}),l})()]}}),a(S,{get when(){var l;return(l=r.data)==null?void 0:l.data.eventData},get children(){return[a(_,{get title(){return t()("job_payload")}}),(()=>{var l=N();return P(l,a(G,{get title(){return t()("job_payload")},get json(){var i;return((i=r.data)==null?void 0:i.data.eventData)||{}}})),l})()]}})]})},V=e=>{const r=Q({triggers:{preview:!1}}),l=w.jobs.useGetMultiple({queryParams:{queryString:e.state.searchParams.getQueryString},enabled:()=>e.state.searchParams.getSettled()});return a(J,{get state(){var i;return{isError:l.isError,isSuccess:l.isSuccess,isEmpty:((i=l.data)==null?void 0:i.data.length)===0,searchParams:e.state.searchParams}},get slot(){return{footer:a(R,{get state(){var i;return{searchParams:e.state.searchParams,meta:(i=l.data)==null?void 0:i.meta}},options:{padding:"24"}})}},get copy(){return{noEntries:{title:t()("no_jobs"),description:t()("no_jobs_description")}}},get children(){return[a($,{key:"jobs.list",get rows(){var i;return((i=l.data)==null?void 0:i.data.length)||0},get searchParams(){return e.state.searchParams},get head(){return[{label:t()("status"),key:"status",icon:a(g,{})},{label:t()("event_type"),key:"eventType",icon:a(g,{})},{label:t()("queue_adapter"),key:"queueAdapterKey",icon:a(g,{})},{label:t()("attempts"),key:"attempts",icon:a(b,{})},{label:t()("max_attempts"),key:"maxAttempts",icon:a(b,{})},{label:t()("priority"),key:"priority",icon:a(b,{})},{label:t()("created_at"),key:"createdAt",icon:a(y,{}),sortable:!0},{label:t()("scheduled_for"),key:"scheduledFor",icon:a(y,{}),sortable:!0},{label:t()("completed_at"),key:"completedAt",icon:a(y,{}),sortable:!0}]},get state(){return{isLoading:l.isFetching,isSuccess:l.isSuccess}},options:{isSelectable:!1},children:({include:i,isSelectable:n,selected:o,setSelected:c})=>a(C,{get each(){var d;return((d=l.data)==null?void 0:d.data)||[]},children:(d,u)=>a(H,{index:u,get job(){return d()},include:i,get selected(){return o[u]},rowTarget:r,options:{isSelectable:n},callbacks:{setSelected:c}})})}),a(U,{get id(){return r.getTargetId},get state(){return{open:r.getTriggers().preview,setOpen:i=>{r.setTrigger("preview",i)}}}})]}})},_e=()=>{const e=F(),r=I({filters:{jobId:{value:"",type:"text"},eventType:{value:"",type:"text"},status:{value:"",type:"array"},queueAdapterKey:{value:"",type:"text"}},sorts:{createdAt:"desc",scheduledFor:void 0,startedAt:void 0,completedAt:void 0,failedAt:void 0,priority:void 0,attempts:void 0}},{singleSort:!0});return a(L,{get slots(){return{header:a(O,{get copy(){return{title:t()("system_queue_observability_route_title"),description:t()("system_queue_observability_route_description")}},get slots(){return{bottom:a(K,{searchParams:r,onRefresh:()=>{e.invalidateQueries({queryKey:["jobs.getMultiple"]})},get filters(){return[{label:t()("job_id"),key:"jobId",type:"text"},{label:t()("event_type"),key:"eventType",type:"text"},{label:t()("status"),key:"status",type:"multi-select",options:[{label:t()("pending"),value:"pending"},{label:t()("processing"),value:"processing"},{label:t()("completed"),value:"completed"},{label:t()("failed"),value:"failed"},{label:t()("cancelled"),value:"cancelled"}]},{label:t()("queue_adapter"),key:"queueAdapterKey",type:"text"}]},get sorts(){return[{label:t()("created_at"),key:"createdAt"},{label:t()("scheduled_for"),key:"scheduledFor"},{label:t()("started_at"),key:"startedAt"},{label:t()("completed_at"),key:"completedAt"},{label:t()("failed_at"),key:"failedAt"},{label:t()("priority"),key:"priority"},{label:t()("attempts"),key:"attempts"}]},perPage:[]})}}})}},get children(){return a(V,{state:{searchParams:r}})}})};export{_e as default};
