import{j as m,aB as D,b as d,f as U,y as h}from"./index-CQ3-BSEL.js";const E=1,Q=10,te=(p,y)=>{const v=m(),[,R]=D(),[A,V]=d(p),[M,w]=d(!1),[F,I]=d(),[W,$]=d(""),[N,K]=d(""),[_,G]=d(!1),[P,B]=d(new Map),[O,q]=d(new Map),[x,b]=d({page:E,perPage:Q}),T=t=>{if(t!==void 0)return typeof t=="boolean"?t?"1":"0":Array.isArray(t)?t.length?t.join(","):void 0:t.toString()},j=t=>{const e=new URLSearchParams(v.search),n=A();if(t.filters)for(const[s,l]of Object.entries(t.filters)){const f=T(l);f?e.set(`filter[${s}]`,f):e.delete(`filter[${s}]`)}if(t.sorts){const s=[];if(y!=null&&y.singleSort){const f=Object.keys(t.sorts)[0],i=t.sorts[f];i&&s.push({key:f,value:i,raw:i==="asc"?f:`-${f}`})}else{const f=e.get("sort");if(f){const i=f.split(",");for(const c of i){const u=c.startsWith("-")?c.slice(1):c;n!=null&&n.sorts&&(n==null?void 0:n.sorts[u])!==void 0&&(c.startsWith("-")?s.push({key:c.slice(1),value:"desc",raw:c}):s.push({key:c,value:"asc",raw:c}))}}for(const[i,c]of Object.entries(t.sorts))if(c===void 0){const u=s.findIndex(a=>a.key===i);u!==-1&&s.splice(u,1)}else{const u=s.findIndex(a=>a.key===i);u!==-1?(s[u].value=c,s[u].raw=c==="asc"?i:`-${i}`):s.push({key:i,value:c,raw:c==="asc"?i:`-${i}`})}}const l=s.map(f=>f.raw).join(",");l?e.set("sort",l):e.delete("sort")}t.pagination&&(t.pagination.page?e.set("page",t.pagination.page.toString()):e.delete("page"),t.pagination.perPage?e.set("perPage",t.pagination.perPage.toString()):e.delete("perPage"));const r=new URLSearchParams(v.search),o={};for(const[s,l]of e.entries())o[s]=l;for(const[s]of r.entries())e.has(s)||(o[s]=void 0);R(o,{scroll:!1})},z=t=>{var f,i,c,u;const e=new Map,n=new Map,r=A();if(r!=null&&r.filters)for(const[a]of Object.entries(r.filters))e.set(a,void 0);if(r!=null&&r.sorts)for(const[a]of Object.entries(r.sorts))n.set(a,void 0);for(const[a,S]of t.entries())if(a.startsWith("filter[")){const g=a.slice(7,-1);if(r!=null&&r.filters&&((f=r.filters[g])==null?void 0:f.type)==="boolean")S==="1"?e.set(g,!0):S==="0"?e.set(g,!1):e.set(g,void 0);else if(r!=null&&r.filters&&((i=r.filters[g])==null?void 0:i.type)==="array"){const Z=S.split(",").map(L=>Number.isNaN(Number(L))?L:Number(L));e.set(g,Z)}else if(r!=null&&r.filters&&((c=r.filters[g])==null?void 0:c.type)==="text")e.set(g,S);else if(r!=null&&r.filters&&((u=r.filters[g])==null?void 0:u.type)==="number"){const k=Number.isNaN(Number(S))?S:Number(S);e.set(g,k)}}const o=t.get("sort");if(o){const a=o.split(",");for(let S=0;S<a.length;S++){const g=a[S];if(g.startsWith("-")){const k=g.slice(1);n.set(k,"desc")}else n.set(g,"asc")}}const s=t.get("page"),l=t.get("perPage");b(s?a=>({...a,page:Number(s)}):a=>({...a,page:E})),b(l?a=>({...a,perPage:Number(l)}):a=>({...a,perPage:Q})),B(e),q(n)},C=()=>{const t=new URLSearchParams;for(const[o,s]of P()){const l=T(s);l!==void 0&&t.set(`filter[${o}]`,l)}const e=O();let n="";for(const[o,s]of e)s==="asc"?n+=`${o},`:s==="desc"&&(n+=`-${o},`);n&&(n=n.slice(0,-1),t.set("sort",n));const r=x();r.page&&t.set("page",r.page.toString()),r.perPage&&t.set("perPage",r.perPage.toString()),$(N()),K(t.toString())},H=()=>{if(_())return;G(!0);const t=new URLSearchParams(v.search),e=A();let n=!1;if(e!=null&&e.filters){for(const[f]of Object.entries(e.filters))if(t.has(`filter[${f}]`)){n=!0;break}}let r=!1;e!=null&&e.sorts&&t.has("sort")&&(r=!0);let o=!1;if(e!=null&&e.pagination&&(t.has("page")||t.has("perPage"))&&(o=!0),n&&r&&o)return;const s={};if(e!=null&&e.filters)for(const[f,i]of Object.entries(e.filters))s[`${f}`]=i.value;const l=Object.entries((e==null?void 0:e.sorts)||{}).reduce((f,[i,c])=>(c&&(f[i]=c),f),{});j({filters:n?void 0:s,sorts:r?void 0:l,pagination:o||e==null?void 0:e.pagination})},J=()=>{var n,r;const t=P(),e={};for(const[o]of t)e[o]=(r=(n=p==null?void 0:p.filters)==null?void 0:n[o])==null?void 0:r.value;j({filters:e})};U(()=>{(y==null?void 0:y.manualSettled)!==!0&&w(!1),H();const t=new URLSearchParams(v.search);z(t),C()}),U(()=>{const t=N();if(t!==W()){if(y!=null&&y.manualSettled)return;F()&&clearTimeout(F());const e=setTimeout(()=>{w(!0)},1);I(e),$(t)}});const X=h(()=>{const t=P();for(const e of t)if(e[1]!==void 0)return!0;return!1}),Y=h(()=>{var e;const t=P();for(const[n,r]of t){const o=(e=p==null?void 0:p.filters)==null?void 0:e[n];if(o){if(o.type==="text"){const s=r===void 0||r===""?"":String(r),l=o.value===void 0||o.value===""?"":String(o.value);if(s!==l)return!1}else if(o.type==="boolean"){if((r===""||r===void 0?void 0:r)!==o.value)return!1}else if(o.type==="array"){const s=i=>i===""||i===void 0?[]:Array.isArray(i)?i:[i],l=s(r),f=s(o.value);if(l.length!==f.length)return!1;for(let i=0;i<l.length;i++)if(String(l[i])!==String(f[i]))return!1}else if(r!==o.value)return!1}}return!0});return{getFilters:P,getSorts:O,getPagination:x,getSettled:M,getQueryString:N,setParams:j,setFilterSchema:t=>{V(e=>({...e,filters:t})),setTimeout(()=>{w(!0)},1)},hasFiltersApplied:X,resetFilters:J,hasDefaultFiltersApplied:Y}};export{Q as D,E as a,te as u};
